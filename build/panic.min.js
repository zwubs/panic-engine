!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).PANIC={},e.THREE)}(this,(function(e,t){"use strict";class n extends t.Scene{constructor(){super(),this.background=new t.Color(2236962),this.fog=new t.FogExp2(new t.Color(2236962),.025),this.add(new t.HemisphereLight(16777215,16777215,1));let e=new t.DirectionalLight(16777215,1.25);e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.01,e.shadow.camera.far=25,e.shadow.bias=-.001,e.position.set(.5,1,-.75),e.position.multiplyScalar(3),this.add(e)}}const i=new n;class r extends t.PerspectiveCamera{constructor(){super(45,1920/1080,.1,1e3),this.position.set(0,1,-4),this.aspect=window.innerWidth/window.innerHeight,this.updateProjectionMatrix()}}const s=new r;let a=document.createElement("div");a.id="PANIC",a.style="\n\twidth: 100%;\n\theight: 100%;\n\tuser-select: none;\n",a.tabIndex=1,document.body.appendChild(a),a.focus();let o=document.createElement("canvas");o.id="PANIC-Canvas",a.appendChild(o);class l{constructor(e,t,n=!1,i=!1){this.id=e,this.manager=t,this.loop=n,this.store=i,i&&(this.manager.store[this.id]=null),this.aliases={},this.functions=[]}emit(e=null){this.store&&(this.manager.store[this.id]=e),this.functions.forEach(((t,n)=>t.bind(this.manager.binding,e).apply(null,null)))}add(e){this.functions.push(e)}addAlias(e){this.aliases[e.id]=e}removeAlias(e){delete this.aliases[e],this.manager.unregisterEventAlias(eventAlias.id)}clear(){this.functions=[]}}class c{constructor(e,t){this.id=e,this.event=t,this.event.addAlias(this)}set loop(e){this.event.loop=e}get loop(){return this.event.loop}get store(){return this.event.store}emit(e){this.event.emit(e)}add(e){this.event.add(e)}clear(){this.event.clear()}}class u extends l{constructor(e,t,n,i){super(e,t,n,i),this.manager.element.addEventListener(this.id,this,{capture:!0})}handleEvent(e){e.preventDefault(),this.emit(e)}remove(){this.manager.element.removeEventListener(this.id,this,!0),this.manager.unregisterEvent(this.id)}}let h=["copy","cut","paste","abort","blur","focus","auxclick","beforeinput","canplay","canplaythrough","change","click","close","contextmenu","cuechange","dblclick","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop","durationchange","emptied","ended","formdata","input","invalid","keydown","keypress","keyup","load","loadeddata","loadedmetadata","loadend","loadstart","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","wheel","pause","play","playing","progress","ratechange","reset","resize","scroll","securitypolicyviolation","seeked","seeking","select","slotchange","stalled","submit","suspend","timeupdate","volumechange","waiting","selectstart","selectionchange","toggle","pointercancel","pointerdown","pointerup","pointermove","pointerout","pointerover","pointerenter","pointerleave","gotpointercapture","lostpointercapture","mozfullscreenchange","mozfullscreenerror","animationcancel","animationend","animationiteration","animationstart","transitioncancel","transitionend","transitionrun","transitionstart","webkitanimationend","webkitanimationiteration","webkitanimationstart","webkittransitionend","error","fullscreenchange","fullscreenerror","gamepadconnected","gamepaddisconnected"];const d=new class{constructor(){this.data=[],this.pass=0}update(){this.pass++;for(let e=0;e<this.data.length;e++)this.pass%this.data[e].interval==0&&"function"==typeof this.data[e].object.update&&this.data[e].object.update()}add(e,t=1){this.data.push(new m(e,t))}remove(e){}};class m{constructor(e,t=1){this.object=e,this.interval=t<=0?1:t}}let p=!1;function g(e){p&&console.log(e)}function f(e){p&&console.warn(e)}class v{constructor(e,t){this.events={},this.queue={},this.store={},this.element=e||a,this.binding=t||window,d.add(this)}registerEvent(e,t,n){return h.includes(e)?(f(`EventManager.registerEvent(): '${e}' is a NativeEvent and cannot be registered`),!1):e in this.events?(f(`EventManager.registerEvent(): '${e}' already registered in EventManager`),!1):void(this.events[e]=new l(e,this,t,n))}registerEventAlias(e,t){return h.includes(e)?(f(`EventManager.registerEventAlias(): '${e}' is a NativeEvent and cannot be registered`),!1):h.includes(t)?(f(`EventManager.registerEventAlias(): NativeEvent '${t}' cannot be given an alias`),!1):e in this.events?(f(`EventManager.registerEventAlias(): '${e}' is already registered`),!1):t in this.events?void(this.events[e]=new c(e,this.events[t])):(f(`EventManager.registerEventAlias(): '${t}' isnt' registered`),!1)}unregisterEvent(e){if(!(e in this.events))return f(`EventManager.unregisterEvent(): '${e}' isn't registered in EventManager`),!1;for(let t in this.events[e].aliases)this.unregisterEventAlias(this.events[e].aliases[t].id);this.events[e].clear(),delete this.events[e]}unregisterEventAlias(e){if(console.log(e,this.events),!(e in this.events))return f(`EventManager.unregisterEventAlias(): '${e}' is already registered`),!1;delete this.events[e]}registerNativeEvent(e,t,n){return h.includes(e)?e in this.events?(f(`EventManager.registerNativeEvent(): ${e} already registered in EventManager`),!1):void(this.events[e]=new u(e,this,t,n)):(f(`EventManager.registerNativeEvent(): '${e}' is not a NativeEvent`),!1)}unregisterNativeEvent(e){this.unregisterEvent(e)}clearQueue(){this.queue={}}hasEvent(e){return this.events.hasOwnProperty(e)}emit(e,t,n=!1){return e in this.events?this.events[e]instanceof u?(f(`EventManager.emit(): NativeEvent '${e}' cannot be emitted by user.`),!1):void(this.events[e]instanceof c?this.queue[this.events[e].event.id]={loop:n,data:t}:this.queue[e]={loop:n,data:t}):(f(`EventManager.emit(): '${e}' isn't registered in EventManager`),!1)}eventActive(e){return this.hasEvent(e)?this.queue.hasOwnProperty(e):(f(`EventManager.hasEvent(): '${e}' isn't registered in EventManager`),!1)}getStore(e){return this.store.hasOwnProperty(e)?this.store[e]:(f(`EventManager.getStore(): '${e}' isn't registered in EventManager`),!1)}breakLoop(e){this.events[e]instanceof c?this.events[e].event.id in this.queue&&(this.queue[this.events[e].event.id].loop=!1):e in this.queue&&(this.queue[e].loop=!1)}on(e,t){return e in this.events?"function"!=typeof t?(f(`EventManager.on( '${e}', ${t} ): 2nd paramater must be Function`),!1):void this.events[e].add(t):(f(`EventManager.on(): '${e}' isn't registered in EventManager`),!1)}update(){for(const[e,t]of Object.entries(this.queue))this.events[e].emit(t.data),0==t.loop&&delete this.queue[e]}}class E extends t.WebGLRenderer{constructor(){super({canvas:o}),this.shadowMap.enabled=!0,this.shadowMap.type=t.BasicShadowMap,this.outputEncoding=t.sRGBEncoding,this.toneMapping=t.LinearToneMapping,this.toneMappingExposure=.75,this.eventManager=new v(window),this.eventManager.registerNativeEvent("resize"),this.eventManager.on("resize",this.onResize.bind(this)),this.onResize()}kill(){this.getContext().getExtension("WEBGL_lose_context").loseContext()}onResize(e){s.aspect=a.clientWidth/a.clientHeight,s.updateProjectionMatrix(),this.setPixelRatio(window.devicePixelRatio),this.setSize(a.clientWidth,a.clientHeight)}get canvas(){return this.domElement}}const b=new E;class _{consturctor(){this.time=0,this.past=0,this.delta=0,this.framecap=60}update(e){this.past=this.time,this.time=e,this.delta=(this.time-this.past)/(1e3/this.framecap)}seconds(e=!1){return e?Math.floor(this.time/1e3):this.time/1e3}minutes(e=!1){return e?Math.floor(this.time/6e4):this.time/6e4}hours(e=!1){return e?Math.floor(this.time/36e5):this.time/36e5}get seconds(){return this.seconds()}get minutes(){return this.minutes()}get hours(){return this.hours()}}class y extends t.BoxBufferGeometry{constructor(e,t,n){super(e,t,n),this.attributes.position.array.set([.5,.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5],24),this.attributes.position.array.set([.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5],36),this.attributes.position.needsUpdate=!0}}class w extends t.Texture{constructor(e){e instanceof Image||(e=PANIC.Unknown),super(e),this.generateMipmaps=!1,this.magFilter=t.NearestFilter,this.minFilter=t.LinearFilter,this.wrapS=t.RepeatWrapping,this.wrapT=t.RepeatWrapping,this.premultiplyAlpha=!0,this.encoding=t.sRGBEncoding,this.needsUpdate=!0}get width(){return this.image.width}get w(){return this.image.width}get height(){return this.image.height}get h(){return this.image.height}}const A={type:"change"},M={type:"start"},T={type:"end"};class P extends t.EventDispatcher{constructor(e,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",$),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(A),i.update(),s=r.NONE},this.update=function(){const n=new t.Vector3,d=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),m=d.clone().invert(),p=new t.Vector3,g=new t.Quaternion,f=2*Math.PI;return function(){const e=i.object.position;n.copy(e).sub(i.target),n.applyQuaternion(d),o.setFromVector3(n),i.autoRotate&&s===r.NONE&&O(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(o.theta+=l.theta*i.dampingFactor,o.phi+=l.phi*i.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let t=i.minAzimuthAngle,v=i.maxAzimuthAngle;return isFinite(t)&&isFinite(v)&&(t<-Math.PI?t+=f:t>Math.PI&&(t-=f),v<-Math.PI?v+=f:v>Math.PI&&(v-=f),o.theta=t<=v?Math.max(t,Math.min(v,o.theta)):o.theta>(t+v)/2?Math.max(t,o.theta):Math.min(v,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=c,o.radius=Math.max(i.minDistance,Math.min(i.maxDistance,o.radius)),!0===i.enableDamping?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),n.setFromSpherical(o),n.applyQuaternion(m),e.copy(i.target).add(n),i.object.lookAt(i.target),!0===i.enableDamping?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),c=1,!!(h||p.distanceToSquared(i.object.position)>a||8*(1-g.dot(i.object.quaternion))>a)&&(i.dispatchEvent(A),p.copy(i.object.position),g.copy(i.object.quaternion),h=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",W),i.domElement.removeEventListener("pointerdown",K),i.domElement.removeEventListener("pointercancel",V),i.domElement.removeEventListener("wheel",Y),i.domElement.removeEventListener("pointermove",z),i.domElement.removeEventListener("pointerup",F),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",$)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const a=1e-6,o=new t.Spherical,l=new t.Spherical;let c=1;const u=new t.Vector3;let h=!1;const d=new t.Vector2,m=new t.Vector2,p=new t.Vector2,g=new t.Vector2,f=new t.Vector2,v=new t.Vector2,E=new t.Vector2,b=new t.Vector2,_=new t.Vector2,y=[],w={};function P(){return Math.pow(.95,i.zoomSpeed)}function O(e){l.theta-=e}function D(e){l.phi-=e}const S=function(){const e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),u.add(e)}}(),x=function(){const e=new t.Vector3;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),N=function(){const e=new t.Vector3;return function(t,n){const r=i.domElement;if(i.object.isPerspectiveCamera){const s=i.object.position;e.copy(s).sub(i.target);let a=e.length();a*=Math.tan(i.object.fov/2*Math.PI/180),S(2*t*a/r.clientHeight,i.object.matrix),x(2*n*a/r.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(S(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),x(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function C(e){i.object.isPerspectiveCamera?c/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(e){i.object.isPerspectiveCamera?c*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function R(e){d.set(e.clientX,e.clientY)}function U(e){g.set(e.clientX,e.clientY)}function I(){if(1===y.length)d.set(y[0].pageX,y[0].pageY);else{const e=.5*(y[0].pageX+y[1].pageX),t=.5*(y[0].pageY+y[1].pageY);d.set(e,t)}}function G(){if(1===y.length)g.set(y[0].pageX,y[0].pageY);else{const e=.5*(y[0].pageX+y[1].pageX),t=.5*(y[0].pageY+y[1].pageY);g.set(e,t)}}function B(){const e=y[0].pageX-y[1].pageX,t=y[0].pageY-y[1].pageY,n=Math.sqrt(e*e+t*t);E.set(0,n)}function k(e){if(1==y.length)m.set(e.pageX,e.pageY);else{const t=q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);m.set(n,i)}p.subVectors(m,d).multiplyScalar(i.rotateSpeed);const t=i.domElement;O(2*Math.PI*p.x/t.clientHeight),D(2*Math.PI*p.y/t.clientHeight),d.copy(m)}function j(e){if(1===y.length)f.set(e.pageX,e.pageY);else{const t=q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);f.set(n,i)}v.subVectors(f,g).multiplyScalar(i.panSpeed),N(v.x,v.y),g.copy(f)}function H(e){const t=q(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);b.set(0,s),_.set(0,Math.pow(b.y/E.y,i.zoomSpeed)),C(_.y),E.copy(b)}function K(e){!1!==i.enabled&&(0===y.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",z),i.domElement.addEventListener("pointerup",F)),function(e){y.push(e)}(e),"touch"===e.pointerType?function(e){switch(Z(e),y.length){case 1:switch(i.touches.ONE){case t.TOUCH.ROTATE:if(!1===i.enableRotate)return;I(),s=r.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===i.enablePan)return;G(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&B(),i.enablePan&&G(),s=r.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&B(),i.enableRotate&&I(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(M)}(e):function(e){let n;switch(e.button){case 0:n=i.mouseButtons.LEFT;break;case 1:n=i.mouseButtons.MIDDLE;break;case 2:n=i.mouseButtons.RIGHT;break;default:n=-1}switch(n){case t.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),s=r.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;U(e),s=r.PAN}else{if(!1===i.enableRotate)return;R(e),s=r.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;R(e),s=r.ROTATE}else{if(!1===i.enablePan)return;U(e),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(M)}(e))}function z(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(Z(e),s){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;k(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;j(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&H(e),i.enablePan&&j(e)}(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&H(e),i.enableRotate&&k(e)}(e),i.update();break;default:s=r.NONE}}(e):function(e){if(!1===i.enabled)return;switch(s){case r.ROTATE:if(!1===i.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),p.subVectors(m,d).multiplyScalar(i.rotateSpeed);const t=i.domElement;O(2*Math.PI*p.x/t.clientHeight),D(2*Math.PI*p.y/t.clientHeight),d.copy(m),i.update()}(e);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),_.subVectors(b,E),_.y>0?C(P()):_.y<0&&L(P()),E.copy(b),i.update()}(e);break;case r.PAN:if(!1===i.enablePan)return;!function(e){f.set(e.clientX,e.clientY),v.subVectors(f,g).multiplyScalar(i.panSpeed),N(v.x,v.y),g.copy(f),i.update()}(e)}}(e))}function F(e){X(e),0===y.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",z),i.domElement.removeEventListener("pointerup",F)),i.dispatchEvent(T),s=r.NONE}function V(e){X(e)}function Y(e){!1!==i.enabled&&!1!==i.enableZoom&&s===r.NONE&&(e.preventDefault(),i.dispatchEvent(M),function(e){e.deltaY<0?L(P()):e.deltaY>0&&C(P()),i.update()}(e),i.dispatchEvent(T))}function $(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:N(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:N(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:N(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:N(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function W(e){!1!==i.enabled&&e.preventDefault()}function X(e){delete w[e.pointerId];for(let t=0;t<y.length;t++)if(y[t].pointerId==e.pointerId)return void y.splice(t,1)}function Z(e){let n=w[e.pointerId];void 0===n&&(n=new t.Vector2,w[e.pointerId]=n),n.set(e.pageX,e.pageY)}function q(e){const t=e.pointerId===y[0].pointerId?y[1]:y[0];return w[t.pointerId]}i.domElement.addEventListener("contextmenu",W),i.domElement.addEventListener("pointerdown",K),i.domElement.addEventListener("pointercancel",V),i.domElement.addEventListener("wheel",Y,{passive:!1}),this.update()}}let O=new P(s,o);O.traget=new t.Vector3(0,0,0),O.update();class D{constructor(e){this.name="string"==typeof x?e:"Undefined",this.x=0,this.y=0,this.w=0,this.h=0,this.pattern=[0,1,2,1,0,3,2,3]}set(e,t,n,i){this.x=isNaN(e)?this.x:e,this.y=isNaN(t)?this.y:t,this.w=isNaN(n)?this.w:n,this.h=isNaN(i)?this.h:i}UV(e){let t=[this.x/e.w,(e.h-this.y)/e.h,(this.x+this.w)/e.w,(e.h-this.y-this.h)/e.h];return[t[this.pattern[0]],t[this.pattern[1]],t[this.pattern[2]],t[this.pattern[3]],t[this.pattern[4]],t[this.pattern[5]],t[this.pattern[6]],t[this.pattern[7]]]}editPattern(e,t,n,i,r,s,a,o){let l=[this.pattern[e],this.pattern[t],this.pattern[n],this.pattern[i],this.pattern[r],this.pattern[s],this.pattern[a],this.pattern[o]];this.pattern=l}transform(e){e.translate&&(this.x+=isNaN(e.translate.x)?0:e.translate.x,this.y+=isNaN(e.translate.y)?0:e.translate.y)}get width(){return this.w}get height(){return this.h}}class S{constructor(e,t,n,i,r,s){this.north=e||new D("north"),this.south=t||new D("south"),this.east=n||new D("east"),this.west=i||new D("west"),this.up=r||new D("up"),this.down=s||new D("down")}setAll(e=0,t=0,n=0,i=0){this.north.set(e,t,n,i),this.south.set(e,t,n,i),this.east.set(e,t,n,i),this.west.set(e,t,n,i),this.up.set(e,t,n,i),this.down.set(e,t,n,i)}clone(e){let t=["north","south","east","west","up","down"];for(let n of t)this[n].x=e[n].x,this[n].y=e[n].y,this[n].w=e[n].w,this[n].h=e[n].h}}class N{constructor(){this.groups={}}addTileGroup(e,t){this.groups[e]=t}}const C={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222};let L={};for(var R in C)L[C[R]]=R;const U=new class{constructor(){this.eventManager=new v,this.eventManager.registerNativeEvent("keydown"),this.eventManager.on("keydown",this.handleKeyDown.bind(this)),this.eventManager.registerNativeEvent("keyup"),this.eventManager.on("keyup",this.handleKeyUp.bind(this)),this.registerKeyEvents(),this.eventManager.registerNativeEvent("blur"),this.eventManager.on("blur",this.handleBlur.bind(this))}registerKeyEvents(){for(let e in C)this.eventManager.registerEvent(`KEY_DOWN_${e}`),this.eventManager.registerEvent(`KEY_UP_${e}`),this.eventManager.registerEvent(`KEY_HELD_${e}`)}handleKeyUp(e){this.eventManager.emit(`KEY_UP_${L[e.keyCode]}`,{}),this.eventManager.breakLoop(`KEY_HELD_${L[e.keyCode]}`)}handleKeyDown(e){e.repeat||(this.eventManager.emit(`KEY_DOWN_${L[e.keyCode]}`,{}),this.eventManager.emit(`KEY_HELD_${L[e.keyCode]}`,{},!0))}onKey(e,t){this.checkValidKey(e,"onKey")&&this.eventManager.on(`KEY_HELD_${e}`,t)}onKeyDown(e,t){this.checkValidKey(e,"onKeyDown")&&this.eventManager.on(`KEY_DOWN_${e}`,t)}onKeyUp(e,t){this.checkValidKey(e,"onKeyUp")&&this.eventManager.on(`KEY_UP_${e}`,t)}getKey(e){if(this.checkValidKey(e,"getKey"))return this.eventManager.eventActive(`KEY_HELD_${e}`)}getKeyDown(e){if(this.checkValidKey(e,"getKeyDown"))return this.eventManager.eventActive(`KEY_DOWN_${e}`)}getKeyUp(e){if(this.checkValidKey(e,"getKeyUp"))return this.eventManager.eventActive(`KEY_UP_${e}`)}checkValidKey(e,t){return e in C||(f(`Keyboard.${t}(): '${e}' is not a valid key`),!1)}handleBlur(e){this.eventManager.clearQueue()}},I={L:0,M:1,R:2},G={0:"L",1:"M",2:"R"};const B=new class{constructor(){this.eventManager=new v,this.eventManager.registerNativeEvent("mousedown"),this.eventManager.on("mousedown",this.handleButtonDown.bind(this)),this.eventManager.registerNativeEvent("mouseup"),this.eventManager.on("mouseup",this.handleButtonUp.bind(this)),this.eventManager.registerNativeEvent("click"),this.eventManager.on("click",this.handleClick.bind(this)),this.eventManager.registerNativeEvent("mousemove"),this.eventManager.on("mousemove",this.handleMove.bind(this)),this.eventManager.registerNativeEvent("wheel"),this.eventManager.on("wheel",this.handleScroll.bind(this)),this.registerMouseEvents(),this.eventManager.registerNativeEvent("blur"),this.eventManager.on("blur",this.handleBlur.bind(this))}registerMouseEvents(){for(let e in I)this.eventManager.registerEvent(`MOUSE_DOWN_${e}`),this.eventManager.registerEvent(`MOUSE_UP_${e}`),this.eventManager.registerEvent(`MOUSE_CLICK_${e}`),this.eventManager.registerEvent(`MOUSE_HELD_${e}`);this.eventManager.registerEvent("MOUSE_SCROLL",!1,!0),this.eventManager.registerEvent("MOUSE_MOVE",!1,!0)}handleButtonUp(e){this.eventManager.emit(`MOUSE_UP_${G[e.button]}`,{}),this.eventManager.breakLoop(`MOUSE_HELD_${G[e.button]}`)}handleButtonDown(e){this.eventManager.emit(`MOUSE_DOWN_${G[e.button]}`,{}),this.eventManager.emit(`MOUSE_HELD_${G[e.button]}`,{},!0)}handleClick(e){this.eventManager.emit(`MOUSE_CLICK_${G[e.button]}`,{})}onButton(e,t){this.checkValidButton(e,"onButton")&&this.eventManager.on(`MOUSE_HELD_${e}`,t)}onButtonDown(e,t){this.checkValidButton(e,"onButtonDown")&&this.eventManager.on(`MOUSE_DOWN_${e}`,t)}onButtonUp(e,t){this.checkValidButton(e,"onButtonUp")&&this.eventManager.on(`MOUSE_UP_${e}`,t)}onClick(e,t){this.checkValidButton(e,"onClick")&&this.eventManager.on(`MOUSE_CLICK_${e}`,t)}getButton(e){if(this.checkValidButton(e,"getButton"))return this.eventManager.eventActive(`MOUSE_HELD_${e}`)}getButtonDown(e){if(this.checkValidButton(e,"getButtonDown"))return this.eventManager.eventActive(`MOUSE_DOWN_${e}`)}getButtonUp(e){if(this.checkValidButton(e,"getButtonUp"))return this.eventManager.eventActive(`MOUSE_UP_${e}`)}getClick(e){if(this.checkValidButton(e,"getClick"))return this.eventManager.eventActive(`MOUSE_CLICK_${e}`)}checkValidButton(e,t){return e in I||(f(`Mouse.${t}(): '${e}' is not a valid button`),!1)}handleScroll(e){this.eventManager.emit("MOUSE_SCROLL",{direction:Math.sign(e.deltaY)})}getScroll(){return this.eventManager.eventActive("MOUSE_SCROLL")}getScrollAmount(){return this.eventManager.getStore("MOUSE_SCROLL")}onScroll(e){this.eventManager.on("MOUSE_SCROLL",e)}handleMove(e){this.eventManager.emit("MOUSE_MOVE",{x:e.x,y:e.y})}onMove(e){this.eventManager.on("MOUSE_MOVE",e)}getMove(){return this.eventManager.eventActive("MOUSE_MOVE")}getPosition(){return this.eventManager.getStore("move")}handleBlur(e){this.eventManager.clearQueue()}},k=["GAMEPAD_LSTICK_NORTH","GAMEPAD_LSTICK_SOUTH","GAMEPAD_LSTICK_EAST","GAMEPAD_LSTICK_WEST","GAMEPAD_LSTICK_PRESS","GAMEPAD_RSTICK_NORTH","GAMEPAD_RSTICK_SOUTH","GAMEPAD_RSTICK_EAST","GAMEPAD_RSTICK_WEST","GAMEPAD_RSTICK_PRESS","GAMEPAD_DPAD_NORTH","GAMEPAD_DPAD_SOUTH","GAMEPAD_DPAD_EAST","GAMEPAD_DPAD_WEST","GAMEPAD_RTRIGGER_TOP","GAMEPAD_RTRIGGER_BOTTOM","GAMEPAD_LTRIGGER_TOP","GAMEPAD_LTRIGGER_BOTTOM","GAMEPAD_BUTTON_NORTH","GAMEPAD_BUTTON_SOUTH","GAMEPAD_BUTTON_EAST","GAMEPAD_BUTTON_WEST","GAMEPAD_BUTTON_START","GAMEPAD_BUTTON_SELECT"],j={0:"GAMEPAD_BUTTON_SOUTH",1:"GAMEPAD_BUTTON_EAST",2:"GAMEPAD_BUTTON_WEST",3:"GAMEPAD_BUTTON_NORTH",4:"GAMEPAD_RTRIGGER_TOP",5:"GAMEPAD_LTRIGGER_TOP",6:"GAMEPAD_RTRIGGER_BOTTOM",7:"GAMEPAD_LTRIGGER_BOTTOM",8:"GAMEPAD_BUTTON_SELECT",9:"GAMEPAD_BUTTON_START",10:"GAMEPAD_LSTICK_PRESS",11:"GAMEPAD_RSTICK_PRESS",12:"GAMEPAD_DPAD_NORTH",13:"GAMEPAD_DPAD_SOUTH",14:"GAMEPAD_DPAD_EAST",15:"GAMEPAD_DPAD_WEST"},H={0:["GAMEPAD_LSTICK_WEST","GAMEPAD_LSTICK_EAST"],1:["GAMEPAD_LSTICK_SOUTH","GAMEPAD_LSTICK_NORTH"],2:["GAMEPAD_RSTICK_WEST","GAMEPAD_RSTICK_EAST"],3:["GAMEPAD_RSTICK_SOUTH","GAMEPAD_RSTICK_NORTH"]};!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n.r(t);var i={events:{},publish:function(e,t){this.events.hasOwnProperty(e)&&this.events[e].forEach((e=>e(t)))},subscribe:function(e,t){return this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t),{unsubscribe:function(){this.events[e].splice(this.events[e].indexOf(t),1)}.bind(this)}}};const r="gamepadconnected",s="connect",a="gamepaddisconnected",o="disconnect",l="button_press",c="axis_move",u="left_stick",h={X:0,Y:1},d="right_stick",m={X:2,Y:3},p={button_0:0,button_1:1,button_2:2,button_3:3,button_4:4,button_5:5,button_6:6,button_7:7,button_8:8,button_9:9,button_10:10,button_11:11,button_12:12,button_13:13,button_14:14,button_15:15,button_16:16,button_17:17},g=e=>{console.warn&&"function"==typeof console.warn?console.warn(e):console.log(e)};var f={loopStarted:!1,instances:{},buttonEvents:{joypad:[]},settings:{axisMovementThreshold:.8},remove:function(e){return delete this.instances[e]},on:function(e,t){switch(e){case s:return i.subscribe(s,t);case o:return i.subscribe(o,t);case l:return i.subscribe(l,t);case c:return i.subscribe(c,t)}},vibrate:function(e,t){const{vibrationActuator:n}=e,i=t||this.settings.vibration;if((e=>!!(e&&e.type&&e.playEffect&&"function"==typeof e.playEffect))(n)){const{type:t}=n;return e.vibrationActuator.playEffect(t,i)}g("No vibration actuator interface found - https://developer.mozilla.org/en-US/docs/Web/API/GamepadHapticActuator")},set:function(e){const{axisMovementThreshold:t,vibration:n,customButtonMapping:i}=e,r=parseFloat(t);isNaN(r)||(this.settings.axisMovementThreshold=r),this.settings.vibration=n,this.settings.customButtonMapping=i},trigger:function(e,t){return i.publish(e,t)}},v={id:null,start:function(){const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,{buttonEvents:t}=f;let n=window.navigator.getGamepads();(n=Array.prototype.slice.call(n)).forEach(((e,n)=>{e&&(t.joypad[n]||(t.joypad[n]={}),f.instances[n]=e,E(e),b(e))})),t.joypad.forEach((e=>{e&&Object.keys(e).forEach((t=>{_(t,e)}))})),this.id=e(this.start.bind(this))},stop:function(e){return(window.cancelAnimationFrame||window.webkitCancelAnimationFrame)(e)}};const E=e=>{e.buttons.forEach(((t,n)=>{const{customButtonMapping:i}=f.settings,r=((e,t)=>{let n=[];return Object.keys(t).forEach((i=>{(t[i]===e||Array.isArray(t[i])&&-1!==t[i].indexOf(e))&&n.push(i)})),n})(n,i||p),{buttonEvents:s}=f;r&&r.length&&r.forEach((i=>{t.pressed?(s.joypad[e.index][i]||(s.joypad[e.index][i]={pressed:!0,hold:!1,released:!1}),s.joypad[e.index][i].button=t,s.joypad[e.index][i].index=n,s.joypad[e.index][i].gamepad=e):!t.pressed&&s.joypad[e.index][i]&&(s.joypad[e.index][i].released=!0,s.joypad[e.index][i].hold=!1)}))}))},b=e=>{const{axisMovementThreshold:t}=f.settings,{axes:n}=e,i=n.length/2;n.forEach(((n,r)=>{if(Math.abs(n)>t){let t=null,s=null,a=n;t=r<i?u:d,r!==h.X&&r!==m.X||(s=n<0?"left":"right"),r!==h.Y&&r!==m.Y||(s=n<0?"top":"bottom");const o={gamepad:e,totalSticks:i,stickMoved:t,directionOfMovement:s,axisMovementValue:a,axis:r};return window.dispatchEvent((e=>new CustomEvent(c,{detail:e}))(o))}}))},_=(e,t)=>{if(t[e].pressed){const n=e=>new CustomEvent(l,{detail:e}),{index:i,gamepad:r}=t[e],s={buttonName:e,button:t[e].button,index:i,gamepad:r};window.dispatchEvent(n(s)),t[e].pressed=!1,t[e].hold=!0}else t[e].hold||t[e].released&&delete t[e]};window.addEventListener(r,(e=>{if(i.publish(s,e),!f.loopStarted)return f.loopStarted=!0,v.start()})),window.addEventListener(a,(e=>{if(i.publish(o,e),f.remove(e.gamepad.index),f.buttonEvents.joypad[e.gamepad.index]=null,!Object.keys(f.instances).length)return f.loopStarted=!1,v.stop(v.id)})),window.addEventListener(l,(e=>i.publish(l,e))),window.addEventListener(c,(e=>i.publish(c,e))),window.navigator.getGamepads&&"function"==typeof window.navigator.getGamepads?window.joypad=f:(window.joypad={},g("Your browser does not support the Gamepad API - https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API"))}]);let K=window.joypad;delete window.joypad;const z=new class{constructor(){this.eventManager=new v,K.set({axisMovementThreshold:.3}),K.on("connect",this.handleConnect.bind(this)),K.on("disconnect",this.handleDisconnect.bind(this)),K.on("axis_move",this.handleAxisMove.bind(this)),K.on("button_press",this.handleButtonPress.bind(this)),this.registerEvents()}registerEvents(){for(let e of k)this.eventManager.registerEvent(e)}handleConnect(e){}handleDisconnect(e){}handleAxisMove(e){let t="left"==e.detail.directionOfMovement||"bottom"==e.detail.directionOfMovement?0:1;this.eventManager.emit(H[e.detail.axis][t])}handleButtonPress(e){this.eventManager.emit(j[e.detail.index])}};var F=Object.freeze({__proto__:null,Keyboard:U,Mouse:B,Gamepad:z});let V=new class{constructor(){this.XAxis=Object.freeze(new t.Vector3(1,0,0)),this.YAxis=Object.freeze(new t.Vector3(0,1,0)),this.ZAxis=Object.freeze(new t.Vector3(0,0,1)),this.NAxis=Object.freeze(new t.Vector3(0,0,0)),this.North=Object.freeze(new t.Vector3(0,0,-1)),this.South=Object.freeze(new t.Vector3(0,0,1)),this.East=Object.freeze(new t.Vector3(1,0,0)),this.West=Object.freeze(new t.Vector3(-1,0,0)),this.Up=Object.freeze(new t.Vector3(0,1,0)),this.Down=Object.freeze(new t.Vector3(0,-1,0))}generateUUID(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&s]+e[s>>8&255]+e[s>>16&255]+e[s>>24&255]).toUpperCase()}};class Y{constructor(e){this.uuid=V.generateUUID(),this.template=e,this.position=new t.Vector3(0,0,0),this.rotation=new t.Vector3(0,0,0),this.scale=new t.Vector3(1,1,1),this.actions=e.actions,this.actions.eventManager.binding=this,this.actions.eventManager.emit("INIT"),this.store={},this.skeleton=new t.Skeleton,this.mesh=new t.Mesh(this.template.geometry,this.template.material),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.frustumCulled=!1,this.mesh.customDepthMaterial=new t.MeshDepthMaterial({depthPacking:t.RGBADepthPacking,map:this.template.texture,alphaTest:.5}),i.add(this.mesh),d.add(this)}update(){this.actions.eventManager.emit("UPDATE"),this.mesh.position.copy(this.position),this.mesh.rotation.setFromVector3(this.rotation),this.mesh.scale.copy(this.scale)}}let $={uniforms:t.ShaderLib.lambert.uniforms,vertex:"\n\n\t\t#define LAMBERT\n\n\t\tvarying vec3 vLightFront;\n\t\tvarying vec3 vIndirectFront;\n\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvarying vec3 vLightBack;\n\t\t\tvarying vec3 vIndirectBack;\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <uv_pars_vertex>\n\t\t#include <uv2_pars_vertex>\n\t\t#include <envmap_pars_vertex>\n\t\t#include <bsdfs>\n\t\t#include <lights_pars_begin>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <morphtarget_pars_vertex>\n\t\t#include <skinning_pars_vertex>\n\t\t#include <shadowmap_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#include <uv_vertex>\n\t\t\t#include <uv2_vertex>\n\t\t\t#include <color_vertex>\n\n\t\t\t#include <beginnormal_vertex>\n\t\t\t#include <morphnormal_vertex>\n\t\t\t#include <skinbase_vertex>\n\t\t\t#include <skinnormal_vertex>\n\t\t\t#include <defaultnormal_vertex>\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <morphtarget_vertex>\n\t\t\t#include <skinning_vertex>\n\t\t\t#include <project_vertex>\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <envmap_vertex>\n\t\t\t#include <lights_lambert_vertex>\n\t\t\t#include <shadowmap_vertex>\n\t\t\t#include <fog_vertex>\n\t\t}\n\t",fragment:"\n\t\tuniform vec3 diffuse;\n\t\tuniform vec3 emissive;\n\t\tuniform float opacity;\n\n\t\tvarying vec3 vLightFront;\n\t\tvarying vec3 vIndirectFront;\n\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvarying vec3 vLightBack;\n\t\t\tvarying vec3 vIndirectBack;\n\t\t#endif\n\n\n\t\t#include <common>\n\t\t#include <packing>\n\t\t#include <dithering_pars_fragment>\n\t\t#include <color_pars_fragment>\n\t\t#include <uv_pars_fragment>\n\t\t#include <uv2_pars_fragment>\n\t\t#include <map_pars_fragment>\n\t\t#include <alphamap_pars_fragment>\n\t\t#include <alphatest_pars_fragment>\n\t\t#include <aomap_pars_fragment>\n\t\t#include <lightmap_pars_fragment>\n\t\t#include <emissivemap_pars_fragment>\n\t\t#include <envmap_common_pars_fragment>\n\t\t#include <envmap_pars_fragment>\n\t\t#include <cube_uv_reflection_fragment>\n\t\t#include <bsdfs>\n\t\t#include <lights_pars_begin>\n\t\t#include <fog_pars_fragment>\n\t\t#include <shadowmap_pars_fragment>\n\t\t#include <shadowmask_pars_fragment>\n\t\t#include <specularmap_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\t\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t\t\tvec3 totalEmissiveRadiance = emissive;\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <map_fragment>\n\t\t\t#include <color_fragment>\n\t\t\t#include <alphamap_fragment>\n\t\t\t#include <alphatest_fragment>\n\t\t\t#include <specularmap_fragment>\n\t\t\t#include <emissivemap_fragment>\n\n\t\t\t// accumulation\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t\t\t#else\n\n\t\t\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t\t\t#endif\n\n\t\t\t#include <lightmap_fragment>\n\n\t\t\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t\t\t#else\n\n\t\t\t\treflectedLight.directDiffuse = vLightFront;\n\n\t\t\t#endif\n\n\t\t\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t\t\t// modulation\n\n\t\t\t#include <aomap_fragment>\n\n\t\t\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t\t\t#include <envmap_fragment>\n\n\t\t\t#include <output_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <dithering_fragment>\n\n\t\t}\n\t"};class W{constructor(){this.id="unknown",this.name="Unknown",this.texture=null,this.tileset=null,this.bones=[],this.geometry=null,this.actions=null,this.shader=$,this.uniforms=null,this.material=null}setup(){this.uniforms=t.UniformsUtils.clone(this.shader.uniforms),this.material=new t.ShaderMaterial({defines:{USE_MAP:"",DOUBLE_SIDED:""},uniforms:this.uniforms,vertexShader:this.shader.vertex,fragmentShader:this.shader.fragment,lights:!0,fog:!0,transparent:!0}),this.uniforms.alphaTest=new t.Uniform(.5),this.material.alphaTest=!0,this.uniforms.map=new t.Uniform(this.texture),this.material.map=this.texture,this.material.side=t.DoubleSide,this.material.shadowSide=t.DoubleSide}spawnEntity(){return new Y(this)}}let X=new class{constructor(){this.data=[],this.entities={}}getEntityByName(e){return this.data.find((t=>t.name==e))}getEntityByID(e){return this.data.find((t=>t.id==e))}registerEntity(e){null==this.getEntityByID(e.id)?this.data.push(e):f('Entity "'+entity.id+'" is already registered')}unregisterEntity(e){null!=this.getEntityByID(template.id)&&this.getEntityByID(template.id)}spawnEntity(e){if(null!=this.getEntityByID(e)){let t=this.getEntityByID(e).spawnEntity();return this.entities[t.uuid]=t}}},Z={uniforms:{uDistance:{value:100}},vertex:"\n\n\t\tuniform float uDistance;\n\n\t\tattribute float opacity;\n\n\t\tvarying vec3 vColor;\n\t\tvarying float vOpacity;\n\t\tvarying vec3 worldPosition;\n\n\t\tvoid main() {\n\n\t\t\tvColor.xyz = color.xyz;\n\t\t\tvOpacity = opacity;\n\n\t\t\tvec3 transformed = position.xzy * ( uDistance + distance( cameraPosition.xyz, worldPosition.xyz ) );\n\n\t\t\tworldPosition = transformed;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n\n\t\t}\n\n\t",fragment:"\n\n\t\tuniform float uDistance;\n\n\t\tvarying vec3 vColor;\n\t\tvarying float vOpacity;\n\t\tvarying vec3 worldPosition;\n\n\t\tvoid main() {\n\n\t\t\tfloat d = 1.0 - min( distance( cameraPosition.xyz, worldPosition.xyz ) / uDistance, 1.0 );\n\n\t\t\tgl_FragColor = vec4( vColor, vOpacity * pow( d, 3.0 ) );\n\n\t\t\tif ( gl_FragColor.a <= 0.0 ) discard;\n\n\t\t}\n\n\t"},q={uniforms:{uColor:{value:new t.Color(0)},uScale:{value:1},uSubdivisions:{value:1},uDistance:{value:1}},vertex:"\n\n\t\tuniform float uDistance;\n\n\t\tvarying vec3 worldPosition;\n\n\t\tvoid main() {\n\n\t\t\tvec3 pos = position.xzy * uDistance;\n\t\t\tpos.xz += cameraPosition.xz;\n\n\t\t\tworldPosition = pos;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n\t\t}\n\n\t",fragment:"\n\n\t\tuniform float uScale;\n\t\tuniform float uSubdivisions;\n\t\tuniform vec3 uColor;\n\t\tuniform float uDistance;\n\n\t\tvarying vec3 worldPosition;\n\n\t\tfloat getGrid( float size ) {\n\n\t\t\t vec2 r = worldPosition.xz / size;\n\n\t\t\t vec2 grid = abs( fract( r - 0.5 ) - 0.5 ) / fwidth( r );\n\t\t\t float line = min( grid.x, grid.y );\n\n\t\t\t return 1.0 - min( line, 1.0 );\n\n\t\t }\n\n\t\t void main() {\n\n\t\t\t   float d = 1.0 - min( distance( cameraPosition.xyz, worldPosition.xyz ) / uDistance, 1.0 );\n\n\t\t\t   float g1 = getGrid( uScale / uSubdivisions );\n\t\t\t   float g2 = getGrid( uScale );\n\n\t\t\t   gl_FragColor = vec4( uColor.rgb, mix( g2, g1, g1 ) * pow( d, 3.0 ) );\n\t\t\t   gl_FragColor.a = mix( 0.5 * gl_FragColor.a, gl_FragColor.a, g2 );\n\n\t\t\t   if ( gl_FragColor.a <= 0.0 ) discard;\n\n\t\t}\n\t"};var Q=Object.freeze({__proto__:null,DebugAxes:Z,DebugGrid:q,Entity:$});let J=new function(){this.loader=new t.FileLoader,this.load=async function(e){return await new Promise((t=>{this.loader.load(e,t)}))}},ee=new function(){this.load=async function(e){return await new Promise((t=>{let n=new Image;n.addEventListener("load",(()=>{t(n)})),n.src=e}))}},te=new function(){this.load=async function(e){let t=await ee.load(e);return new w(t)}},ne=new function(){this.parse=function(e){return window.JSON.parse(e)}},ie=new function(){this.parse=function(e,t="Undefined"){let n=new N,i=Object.entries(e);console.groupCollapsed(`Tileset: '${t}'`);for(let[e,t]of i)if(this.isGroup(t)){g(`'${e}' is a group`);let i=this.parseGroup(t,n);n.addTileGroup(e,i)}else g(`'${e}' is unknown`);return console.groupEnd(),n},this.isTile=function(e){for(let t in e)if(("t"==t||"transform"==t)&&"number"==typeof e[t])return!0;return!0},this.parseTile=function(e){},this.isGroup=function(e){let t=["default","clone","transform","north","south","east","west","up","down"],n=Object.entries(e);for(let[e,i]of n){if(!t.includes(e))return!1;if(!this.isTile(i))return!1}return!0},this.parseGroup=function(e,t){let n=new S,i=["north","south","east","west","up","down"];e.clone?n.clone(t.groups[e.clone]):e.default&&n.setAll(e.default.x,e.default.y,e.default.w,e.default.h);for(let t of i)if(e[t]){let i=e[t];isNaN(i.x)||(n[t].x=i.x),isNaN(i.y)||(n[t].y=i.y),isNaN(i.w)||(n[t].w=i.w),isNaN(i.h)||(n[t].h=i.h),i.t&&(i.t.flipX&&n[t].editPattern(2,3,0,1,6,7,4,5),i.t.flipY&&n[t].editPattern(4,5,6,7,0,1,2,3),i.t.translate&&(i.t.translate.x&&(n[t].x+=i.t.translate.x),i.t.translate.y&&(n[t].y+=i.t.translate.y)),i.t.rotate&&(1==i.t.rotate?n[t].editPattern(4,5,0,1,6,7,2,3):2==i.t.rotate?n[t].editPattern(6,7,4,5,2,3,0,1):3==i.t.rotate&&n[t].editPattern(2,3,6,7,0,1,4,5)))}if(e.transform)for(let t of i)n[t]&&(e.transform.translate.x&&(n[t].x+=e.transform.translate.x),e.transform.translate.y&&(n[t].y+=e.transform.translate.y));return n}},re=new function(){this.parse=function(e,t,n,i){let r=["east","west","up","down","south","north"],s=i.groups[e];for(var a=0;a<6;a++){let e=s[r[a]].UV(n);t.attributes.uv.array.set([e[0],e[1]],8*a+0),t.attributes.uv.array.set([e[2],e[3]],8*a+2),t.attributes.uv.array.set([e[4],e[5]],8*a+4),t.attributes.uv.array.set([e[6],e[7]],8*a+6)}}};function se(e){let n,i,r,s=0;for(let t=0;t<e.length;++t){const a=e[t];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===n&&(n=a.array.constructor),n!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=a.array.length}const a=new n(s);let o=0;for(let t=0;t<e.length;++t)a.set(e[t].array,o),o+=e[t].array.length;return new t.BufferAttribute(a,i,r)}let ae=new function(){this.parse=function(e,n){new t.BufferGeometry;let i=[],r=Object.entries(e);for(let[e,s]of r)if(s.cubes)for(let e of s.cubes){let r=new y(1,1,1),s=new t.Matrix4,a=new t.Vector3(1,1,1),o=new t.Vector3(0,0,0),l=new t.Euler(0,0,0);e.size&&a.set(e.size[0],e.size[1],e.size[2]).divideScalar(16).clampScalar(1e-4,Math.min()),e.offset&&o.set(e.offset[0],e.offset[1],e.offset[2]).divideScalar(16),e.rotation&&l.setFromVector3(new t.Vector3(e.rotation[0],e.rotation[1],e.rotation[2]).multiplyScalar(Math.PI/180));let c=(new t.Quaternion).setFromEuler(l,!1);s.compose(o,c,a),r.applyMatrix4(s),e.faces&&re.parse(e.faces,r,n.texture,n.tileset),i.push(r)}return function(e,n=!1){const i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),a={},o={},l=e[0].morphTargetsRelative,c=new t.BufferGeometry;let u=0;for(let t=0;t<e.length;++t){const h=e[t];let d=0;if(i!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(h.attributes[e]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". Make sure all geometries have the same number of attributes."),null;if(l!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!s.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[e]&&(o[e]=[]),o[e].push(h.morphAttributes[e])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(h.userData),n){let e;if(i)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}c.addGroup(u,e,t),u+=e}}if(i){let t=0;const n=[];for(let i=0;i<e.length;++i){const r=e[i].index;for(let e=0;e<r.count;++e)n.push(r.getX(e)+t);t+=e[i].attributes.position.count}c.setIndex(n)}for(const e in a){const t=se(a[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;c.setAttribute(e,t)}for(const e in o){const t=o[e][0].length;if(0===t)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[e]=[];for(let n=0;n<t;++n){const t=[];for(let i=0;i<o[e].length;++i)t.push(o[e][i][n]);const i=se(t);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;c.morphAttributes[e].push(i)}}return c}(i)},this.setupSkinning=function(e,n){for(var i=new Float32Array(e.attributes.position.count),r=0;r<i.length;r++)i.set([n],r);e.setAttribute("skinIndices",new t.BufferAttribute(i,1))}},oe=new function(){};class le{constructor(){this.eventManager=new v}registerAction(e){this.eventManager.registerEvent(e)}addInputBinding(e,t){"KEY"==t.split("_")[0]?U.eventManager.on(t,(()=>{this.eventManager.emit(e)})):t.startsWith("MOUSE")?B.eventManager.on(t,(()=>{this.eventManager.emit(e)})):t.startsWith("GAMEPAD")&&z.eventManager.on(t,(()=>{this.eventManager.emit(e)}))}on(e,t){this.eventManager.on(e,t)}}let ce=new function(){this.load=async function(e){return e.substring(0,e.lastIndexOf("/")+1),await J.load(e)}};let ue=new class{consturctor(){}async parse(e,t,n){let i=new le;for(const[t,r]of Object.entries(e))if("bindings"!=t){i.registerAction(t);let e=await ce.load(n+r);i.on(t,new Function(e)())}for(const[e,n]of Object.entries(t))for(let t of n)i.addInputBinding(e,t);return i}};var he=Object.freeze({__proto__:null,JSON:ne,Tileset:ie,CubeUV:re,EntityModel:ae,EntityArmature:oe,Actions:ue});let de=new function(){this.load=async function(e){let t=e.substring(0,e.lastIndexOf("/")+1),n=await J.load(e),i=await ne.parse(n),r=new W;return r.id=i.id,r.name=i.name,i.actions&&(r.actions=await ue.parse(i.actions,i.bindings,t)),r.texture=await te.load(t+i.texture),r.tileset=await ie.parse(i.tileset,i.id),r.geometry=await ae.parse(i.armature,r),r.setup(),X.registerEntity(r),r}};var me=Object.freeze({__proto__:null,File:J,Image:ee,Texture:te,Entity:de,ActionScript:ce});let pe=document.createElement("div");pe.id="PANIC-Debug",a.appendChild(pe);let ge=new class{constuctor(){this.THREE=void 0}async enable(){p&&(null==this.THREE&&(this.THREE=await import("three")),window.THREE!=this.THREE?(window.THREE=this.THREE,PANIC.Debug.warn("[PANIC] Namespace 'THREE' has been made global")):PANIC.Debug.error("[PANIC] Namespace 'THREE' is already global"))}disable(){p&&(null!=this.THREE&&window.THREE==this.THREE?(window.THREE=void 0,PANIC.Debug.warn("[PANIC] Namespace 'THREE' has been made private")):PANIC.Debug.error("[PANIC] Namespace 'THREE' is already private"))}toggle(){window.THREE!=this.THREE?this.enable():this.disable()}};let fe=new class{constuctor(){this.isGlobal=!1}async enable(){p&&(this.isGlobal?PANIC.Debug.warn("[PANIC] Namespace 'PANIC' is already global"):(window.PANIC=await Promise.resolve().then((function(){return Ae})),this.isGlobal=!0,PANIC.Debug.warn("[PANIC] Namespace 'PANIC' has been made global")))}disable(){p&&(this.isGlobal?(window.PANIC=void 0,this.isGlobal=!1,PANIC.Debug.warn("[PANIC] Namespace 'PANIC' has been made private")):PANIC.Debug.warn("[PANIC] Namespace 'PANIC' is already private"))}toggle(){window.PANIC!=PANIC?this.enable():this.disable()}get THREE(){return ge}};const ve=new class{constructor(){this.id="PANIC-Debug-Grid",this.active=!1,this.geometry=new t.PlaneBufferGeometry(2,2,1,1),this.uniforms={uColor:{value:new t.Color(8947848)},uScale:{value:16},uSubdivisions:{value:16},uDistance:{value:100}},this.material=new t.ShaderMaterial({side:t.DoubleSide,uniforms:this.uniforms,vertexShader:q.vertex,fragmentShader:q.fragment,transparent:!0,depthWrite:!1,extensions:{derivatives:!0}}),this.mesh=new t.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.name=this.id}toggle(e=null){"boolean"==typeof e&&(this.active=!e),this.active?i.getObjectByName(this.id)&&i.remove(this.mesh):null==i.getObjectByName(this.id)&&i.add(this.mesh),this.active=!this.active}get scale(){return this.uniforms.uScale.value}set scale(e){this.uniforms.uScale.value=e}get subdivisions(){return this.uniforms.uSubdivisions.value}set subdivisions(e){this.uniforms.uSubdivisions.value=e}get distance(){return this.uniforms.uDistance.value}set distance(e){this.uniforms.uDistance.value=e}get color(){return this.uniforms.uColor.value}set color(e){this.uniforms.uColor.value=new t.Color(e)}};const Ee=new class{constructor(){this.id="PANIC-Debug-Axes",this.active=!1,this.colors={x:new t.Color(16724818),y:new t.Color(9165824),z:new t.Color(2658559)},this.geometry=new t.BufferGeometry,this.geometry.setAttribute("position",new t.Float32BufferAttribute([-1,0,0,1,0,0,0,0,-1,0,0,1,0,-1,0,0,1,0],3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute([].concat(this.colors.x.toArray(),this.colors.x.toArray(),this.colors.y.toArray(),this.colors.y.toArray(),this.colors.z.toArray(),this.colors.z.toArray()),3)),this.geometry.setAttribute("opacity",new t.Float32BufferAttribute([1,1,1,1,1,1],1)),this.material=new t.ShaderMaterial({uniforms:Z.uniforms,vertexShader:Z.vertex,fragmentShader:Z.fragment,vertexColors:!0,transparent:!0,depthWrite:!1,extensions:{derivatives:!0}}),this.mesh=new t.LineSegments(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.name=this.id}toggle(e=null){"boolean"==typeof e&&(this.active=!e),this.active?i.getObjectByName(this.id)&&i.remove(this.mesh):null==i.getObjectByName(this.id)&&i.add(this.mesh),this.active=!this.active}toggleAxis(e,t=null){var n=[];e.toLowerCase().includes("x")&&n.push(0,1),e.toLowerCase().includes("y")&&n.push(2,3),e.toLowerCase().includes("z")&&n.push(4,5),n?(this.geometry.attributes.opacity.array.forEach(((e,i,r)=>{n.includes(i)&&(r[i]="boolean"==typeof t?t:1-e)})),this.geometry.attributes.opacity.needsUpdate=!0):f(`Invalid axes name "${axis}", use either 'x', 'y', or 'z'`)}updateColors(){this.geometry.attributes.colors.set([].concat(this.colors.x.toArray(),this.colors.x.toArray(),this.colors.y.toArray(),this.colors.y.toArray(),this.colors.z.toArray(),this.colors.z.toArray()),0),this.geometry.attributes.colors.needsUpdate=!0}setColors(e,t){}};let be=new t.Spherical;let _e=new class{constructor(){this.id="PANIC-Debug-Compass",this.element=document.createElement("div"),this.element.id=this.id,this.active=!1,this.state=0}toggle(e=null){this.active="boolean"==typeof e?!e:!this.active,this.active?(pe.appendChild(this.element),d.add(this,15)):(pe.removeChild(this.element),d.remove(this))}update(){var e="",n=new t.Vector3(0,0,0);if(s.getWorldDirection(n),0==this.state){var i=Math.atan2(n.x,n.z),r=Math.round(i/Math.PI*180);r>=112.5||r<=-112.5?e+="N":r>=-67.5&&r<=67.5&&(e+="S"),r>=22.5&&r<=157.5?e+="E":r>=-157.5&&r<=-22.5&&(e+="W")}else if(1==this.state){be.setFromVector3(n),be.makeSafe();let t=Math.round(be.phi/Math.PI*180),i=Math.round(be.theta/Math.PI*180);e+=i>0?"+X":i<0?"-X":"X",e+=t>90?" +Y":t<90?" -Y":" Y",Math.abs(i)>90?e+=" +Z":Math.abs(i)<90?e+=" -Z":e+=" Z"}else if(2==this.state){be.setFromVector3(n),be.makeSafe(),e=`${Math.round(be.phi/Math.PI*180)} ${Math.round(be.theta/Math.PI*180)}`}this.element.innerHTML=`Facing: ${e}`}};var ye=Object.freeze({__proto__:null,Access:fe,Grid:ve,Axes:Ee,Compass:_e,get enabled(){return p},enable:function(){p=!0,console.info("[PANIC] Debug Mode Enabled")},disable:function(){p=!1,console.info("[PANIC] Debug Mode Disabled")},toggle:function(){p=!p},log:g,warn:f,error:function(e){p&&console.error(e)},clear:function(){p&&console.clear()},style:function(e,t){"string"==typeof t&&t instanceof String||(t=""),p&&console.log(e,t)},DebugElement:pe});let we="0.0.3";var Ae=Object.freeze({__proto__:null,Version:we,Scene:i,Camera:s,Renderer:b,Clock:_,Updater:d,Cube:y,Texture:w,OrbitControls:O,Element:a,Tile:D,TileGroup:S,Tileset:N,EventManager:v,Input:F,Entity:Y,EntityTemplate:W,EntityRegistry:X,Shaders:Q,Loaders:me,Parsers:he,Tools:V,Debug:ye});e.Camera=s,e.Clock=_,e.Cube=y,e.Debug=ye,e.Element=a,e.Entity=Y,e.EntityRegistry=X,e.EntityTemplate=W,e.EventManager=v,e.Input=F,e.Loaders=me,e.OrbitControls=O,e.Parsers=he,e.Renderer=b,e.Scene=i,e.Shaders=Q,e.Texture=w,e.Tile=D,e.TileGroup=S,e.Tileset=N,e.Tools=V,e.Updater=d,e.Version=we,Object.defineProperty(e,"__esModule",{value:!0})}));
