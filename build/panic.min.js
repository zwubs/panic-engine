!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).PANIC={},t.THREE)}(this,(function(t,e){"use strict";class n extends e.Scene{constructor(){super(),this.background=new e.Color(2236962),this.fog=new e.FogExp2(new e.Color(2236962),.025),this.add(new e.HemisphereLight(16777215,16777215,1));let t=new e.DirectionalLight(16777215,1.25);t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.01,t.shadow.camera.far=25,t.shadow.bias=-.001,t.position.set(.5,1,-.75),t.position.multiplyScalar(3),this.add(t)}}const i=new n;class s extends e.PerspectiveCamera{constructor(){super(45,1920/1080,.1,1e3),this.position.set(0,1,-4),this.aspect=window.innerWidth/window.innerHeight,this.updateProjectionMatrix()}}const r=new s;let o=document.createElement("div");o.id="PANIC",o.style="\n\twidth: 100%;\n\theight: 100%;\n\tuser-select: none;\n",o.tabIndex=1,document.body.appendChild(o),o.focus();let a=document.createElement("canvas");a.id="PANIC-Canvas",o.appendChild(a);class l{constructor(t,e,n=!1,i=!1){this.id=t,this.manager=e,this.loop=n,this.store=i,i&&(this.manager.store[this.id]=null),this.aliases={},this.functions=[]}emit(t=null){this.store&&(this.manager.store[this.id]=t),this.functions.forEach(((e,n)=>e.bind(this.manager.binding,t).apply(null,null)))}add(t){this.functions.push(t)}addAlias(t){this.aliases[t.id]=t}removeAlias(t){delete this.aliases[t],this.manager.unregisterEventAlias(eventAlias.id)}clear(){this.functions=[]}}class c{constructor(t,e){this.id=t,this.event=e,this.event.addAlias(this)}set loop(t){this.event.loop=t}get loop(){return this.event.loop}get store(){return this.event.store}emit(t){this.event.emit(t)}add(t){this.event.add(t)}clear(){this.event.clear()}}class h extends l{constructor(t,e,n,i){super(t,e,n,i),this.manager.element.addEventListener(this.id,this,{capture:!0})}handleEvent(t){t.preventDefault(),this.emit(t)}remove(){this.manager.element.removeEventListener(this.id,this,!0),this.manager.unregisterEvent(this.id)}}let u=["copy","cut","paste","abort","blur","focus","auxclick","beforeinput","canplay","canplaythrough","change","click","close","contextmenu","cuechange","dblclick","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop","durationchange","emptied","ended","formdata","input","invalid","keydown","keypress","keyup","load","loadeddata","loadedmetadata","loadend","loadstart","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","wheel","pause","play","playing","progress","ratechange","reset","resize","scroll","securitypolicyviolation","seeked","seeking","select","slotchange","stalled","submit","suspend","timeupdate","volumechange","waiting","selectstart","selectionchange","toggle","pointercancel","pointerdown","pointerup","pointermove","pointerout","pointerover","pointerenter","pointerleave","gotpointercapture","lostpointercapture","mozfullscreenchange","mozfullscreenerror","animationcancel","animationend","animationiteration","animationstart","transitioncancel","transitionend","transitionrun","transitionstart","webkitanimationend","webkitanimationiteration","webkitanimationstart","webkittransitionend","error","fullscreenchange","fullscreenerror","gamepadconnected","gamepaddisconnected"];const d=new class{constructor(){this.data=[],this.pass=0}update(){this.pass++;for(let t=0;t<this.data.length;t++)this.pass%this.data[t].interval==0&&"function"==typeof this.data[t].object.update&&this.data[t].object.update()}add(t,e=1){this.data.push(new m(t,e))}remove(t){}};class m{constructor(t,e=1){this.object=t,this.interval=e<=0?1:e}}let p=!1;function g(t){p&&console.log(t)}function f(t){p&&console.warn(t)}class v{constructor(t,e){this.active=!0,this.events={},this.queue={},this.store={},this.element=t||o,this.binding=e||window,d.add(this)}registerEvent(t,e,n){return u.includes(t)?(f(`EventManager.registerEvent(): '${t}' is a NativeEvent and cannot be registered`),!1):t in this.events?(f(`EventManager.registerEvent(): '${t}' already registered in EventManager`),!1):void(this.events[t]=new l(t,this,e,n))}registerEventAlias(t,e){return u.includes(t)?(f(`EventManager.registerEventAlias(): '${t}' is a NativeEvent and cannot be registered`),!1):u.includes(e)?(f(`EventManager.registerEventAlias(): NativeEvent '${e}' cannot be given an alias`),!1):t in this.events?(f(`EventManager.registerEventAlias(): '${t}' is already registered`),!1):e in this.events?void(this.events[t]=new c(t,this.events[e])):(f(`EventManager.registerEventAlias(): '${e}' isnt' registered`),!1)}unregisterEvent(t){if(!(t in this.events))return f(`EventManager.unregisterEvent(): '${t}' isn't registered in EventManager`),!1;for(let e in this.events[t].aliases)this.unregisterEventAlias(this.events[t].aliases[e].id);this.events[t].clear(),delete this.events[t]}unregisterEventAlias(t){if(!(t in this.events))return f(`EventManager.unregisterEventAlias(): '${t}' is already registered`),!1;delete this.events[t]}registerNativeEvent(t,e,n){return u.includes(t)?t in this.events?(f(`EventManager.registerNativeEvent(): ${t} already registered in EventManager`),!1):void(this.events[t]=new h(t,this,e,n)):(f(`EventManager.registerNativeEvent(): '${t}' is not a NativeEvent`),!1)}unregisterNativeEvent(t){this.unregisterEvent(t)}clearQueue(){this.queue={}}hasEvent(t){return this.events.hasOwnProperty(t)}emit(t,e,n=!1){return t in this.events?this.events[t]instanceof h?(f(`EventManager.emit(): NativeEvent '${t}' cannot be emitted by user.`),!1):void(this.active&&(this.events[t]instanceof c?this.queue[this.events[t].event.id]={loop:n,data:e}:this.queue[t]={loop:n,data:e})):(f(`EventManager.emit(): '${t}' isn't registered in EventManager`),!1)}eventActive(t){return this.hasEvent(t)?this.queue.hasOwnProperty(t):(f(`EventManager.hasEvent(): '${t}' isn't registered in EventManager`),!1)}getStore(t){return this.store.hasOwnProperty(t)?this.store[t]:(f(`EventManager.getStore(): '${t}' isn't registered in EventManager`),!1)}breakLoop(t){this.events[t]instanceof c?this.events[t].event.id in this.queue&&(this.queue[this.events[t].event.id].loop=!1):t in this.queue&&(this.queue[t].loop=!1)}on(t,e){return t in this.events?"function"!=typeof e?(f(`EventManager.on( '${t}', ${e} ): 2nd paramater must be Function`),!1):void this.events[t].add(e):(f(`EventManager.on(): '${t}' isn't registered in EventManager`),!1)}update(){if(this.active)for(const[t,e]of Object.entries(this.queue))this.events[t].emit(e.data),0==e.loop&&delete this.queue[t]}}class b extends e.WebGLRenderer{constructor(){super({canvas:a}),this.shadowMap.enabled=!0,this.shadowMap.type=e.BasicShadowMap,this.outputEncoding=e.sRGBEncoding,this.toneMapping=e.LinearToneMapping,this.toneMappingExposure=.75,this.eventManager=new v(window),this.eventManager.registerNativeEvent("resize"),this.eventManager.on("resize",this.onResize.bind(this)),this.onResize()}kill(){this.getContext().getExtension("WEBGL_lose_context").loseContext()}onResize(t){r.aspect=o.clientWidth/o.clientHeight,r.updateProjectionMatrix(),this.setPixelRatio(window.devicePixelRatio),this.setSize(o.clientWidth,o.clientHeight)}get canvas(){return this.domElement}}const E=new b;class y{consturctor(){this.time=0,this.past=0,this.delta=0,this.framecap=60}update(t){this.past=this.time,this.time=t,this.delta=(this.time-this.past)/(1e3/this.framecap)}seconds(t=!1){return t?Math.floor(this.time/1e3):this.time/1e3}minutes(t=!1){return t?Math.floor(this.time/6e4):this.time/6e4}hours(t=!1){return t?Math.floor(this.time/36e5):this.time/36e5}get seconds(){return this.seconds()}get minutes(){return this.minutes()}get hours(){return this.hours()}}class w extends e.BoxBufferGeometry{constructor(t,e,n){super(t,e,n),this.attributes.position.array.set([.5,.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5],24),this.attributes.position.array.set([.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5],36),this.attributes.position.needsUpdate=!0}static identity(){const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array([.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5]),i=new e.BufferGeometry;return i.setIndex(new e.BufferAttribute(t,1)),i.setAttribute("position",new e.BufferAttribute(n,3)),i.computeBoundingSphere(),i}}class _ extends e.Texture{constructor(t){t instanceof Image||(t=PANIC.Unknown),super(t),this.generateMipmaps=!1,this.magFilter=e.NearestFilter,this.minFilter=e.LinearFilter,this.wrapS=e.RepeatWrapping,this.wrapT=e.RepeatWrapping,this.premultiplyAlpha=!0,this.encoding=e.sRGBEncoding,this.needsUpdate=!0}get width(){return this.image.width}get w(){return this.image.width}get height(){return this.image.height}get h(){return this.image.height}}const M={type:"change"},A={type:"start"},S={type:"end"};class T extends e.EventDispatcher{constructor(t,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Y),this._domElementKeyEvents=t},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(M),i.update(),r=s.NONE},this.update=function(){const n=new e.Vector3,d=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),m=d.clone().invert(),p=new e.Vector3,g=new e.Quaternion,f=2*Math.PI;return function(){const t=i.object.position;n.copy(t).sub(i.target),n.applyQuaternion(d),a.setFromVector3(n),i.autoRotate&&r===s.NONE&&T(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let e=i.minAzimuthAngle,v=i.maxAzimuthAngle;return isFinite(e)&&isFinite(v)&&(e<-Math.PI?e+=f:e>Math.PI&&(e-=f),v<-Math.PI?v+=f:v>Math.PI&&(v-=f),a.theta=e<=v?Math.max(e,Math.min(v,a.theta)):a.theta>(e+v)/2?Math.max(e,a.theta):Math.min(v,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),n.setFromSpherical(a),n.applyQuaternion(m),t.copy(i.target).add(n),i.object.lookAt(i.target),!0===i.enableDamping?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),h.set(0,0,0)),c=1,!!(u||p.distanceToSquared(i.object.position)>o||8*(1-g.dot(i.object.quaternion))>o)&&(i.dispatchEvent(M),p.copy(i.object.position),g.copy(i.object.quaternion),u=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",$),i.domElement.removeEventListener("pointerdown",V),i.domElement.removeEventListener("pointercancel",K),i.domElement.removeEventListener("wheel",W),i.domElement.removeEventListener("pointermove",H),i.domElement.removeEventListener("pointerup",F),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",Y)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new e.Spherical,l=new e.Spherical;let c=1;const h=new e.Vector3;let u=!1;const d=new e.Vector2,m=new e.Vector2,p=new e.Vector2,g=new e.Vector2,f=new e.Vector2,v=new e.Vector2,b=new e.Vector2,E=new e.Vector2,y=new e.Vector2,w=[],_={};function x(){return Math.pow(.95,i.zoomSpeed)}function T(t){l.theta-=t}function P(t){l.phi-=t}const O=function(){const t=new e.Vector3;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),h.add(t)}}(),D=function(){const t=new e.Vector3;return function(e,n){!0===i.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),h.add(t)}}(),C=function(){const t=new e.Vector3;return function(e,n){const s=i.domElement;if(i.object.isPerspectiveCamera){const r=i.object.position;t.copy(r).sub(i.target);let o=t.length();o*=Math.tan(i.object.fov/2*Math.PI/180),O(2*e*o/s.clientHeight,i.object.matrix),D(2*n*o/s.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(O(e*(i.object.right-i.object.left)/i.object.zoom/s.clientWidth,i.object.matrix),D(n*(i.object.top-i.object.bottom)/i.object.zoom/s.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function N(t){i.object.isPerspectiveCamera?c/=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*t)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function B(t){i.object.isPerspectiveCamera?c*=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/t)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(t){d.set(t.clientX,t.clientY)}function U(t){g.set(t.clientX,t.clientY)}function R(){if(1===w.length)d.set(w[0].pageX,w[0].pageY);else{const t=.5*(w[0].pageX+w[1].pageX),e=.5*(w[0].pageY+w[1].pageY);d.set(t,e)}}function I(){if(1===w.length)g.set(w[0].pageX,w[0].pageY);else{const t=.5*(w[0].pageX+w[1].pageX),e=.5*(w[0].pageY+w[1].pageY);g.set(t,e)}}function G(){const t=w[0].pageX-w[1].pageX,e=w[0].pageY-w[1].pageY,n=Math.sqrt(t*t+e*e);b.set(0,n)}function k(t){if(1==w.length)m.set(t.pageX,t.pageY);else{const e=Z(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);m.set(n,i)}p.subVectors(m,d).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*p.x/e.clientHeight),P(2*Math.PI*p.y/e.clientHeight),d.copy(m)}function z(t){if(1===w.length)f.set(t.pageX,t.pageY);else{const e=Z(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);f.set(n,i)}v.subVectors(f,g).multiplyScalar(i.panSpeed),C(v.x,v.y),g.copy(f)}function j(t){const e=Z(t),n=t.pageX-e.x,s=t.pageY-e.y,r=Math.sqrt(n*n+s*s);E.set(0,r),y.set(0,Math.pow(E.y/b.y,i.zoomSpeed)),N(y.y),b.copy(E)}function V(t){!1!==i.enabled&&(0===w.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.addEventListener("pointermove",H),i.domElement.addEventListener("pointerup",F)),function(t){w.push(t)}(t),"touch"===t.pointerType?function(t){switch(X(t),w.length){case 1:switch(i.touches.ONE){case e.TOUCH.ROTATE:if(!1===i.enableRotate)return;R(),r=s.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===i.enablePan)return;I(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&G(),i.enablePan&&I(),r=s.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&G(),i.enableRotate&&R(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(A)}(t):function(t){let n;switch(t.button){case 0:n=i.mouseButtons.LEFT;break;case 1:n=i.mouseButtons.MIDDLE;break;case 2:n=i.mouseButtons.RIGHT;break;default:n=-1}switch(n){case e.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(t){b.set(t.clientX,t.clientY)}(t),r=s.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;U(t),r=s.PAN}else{if(!1===i.enableRotate)return;L(t),r=s.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;L(t),r=s.ROTATE}else{if(!1===i.enablePan)return;U(t),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(A)}(t))}function H(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(X(t),r){case s.TOUCH_ROTATE:if(!1===i.enableRotate)return;k(t),i.update();break;case s.TOUCH_PAN:if(!1===i.enablePan)return;z(t),i.update();break;case s.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&j(t),i.enablePan&&z(t)}(t),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&j(t),i.enableRotate&&k(t)}(t),i.update();break;default:r=s.NONE}}(t):function(t){if(!1===i.enabled)return;switch(r){case s.ROTATE:if(!1===i.enableRotate)return;!function(t){m.set(t.clientX,t.clientY),p.subVectors(m,d).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*p.x/e.clientHeight),P(2*Math.PI*p.y/e.clientHeight),d.copy(m),i.update()}(t);break;case s.DOLLY:if(!1===i.enableZoom)return;!function(t){E.set(t.clientX,t.clientY),y.subVectors(E,b),y.y>0?N(x()):y.y<0&&B(x()),b.copy(E),i.update()}(t);break;case s.PAN:if(!1===i.enablePan)return;!function(t){f.set(t.clientX,t.clientY),v.subVectors(f,g).multiplyScalar(i.panSpeed),C(v.x,v.y),g.copy(f),i.update()}(t)}}(t))}function F(t){q(t),0===w.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.removeEventListener("pointermove",H),i.domElement.removeEventListener("pointerup",F)),i.dispatchEvent(S),r=s.NONE}function K(t){q(t)}function W(t){!1!==i.enabled&&!1!==i.enableZoom&&r===s.NONE&&(t.preventDefault(),i.dispatchEvent(A),function(t){t.deltaY<0?B(x()):t.deltaY>0&&N(x()),i.update()}(t),i.dispatchEvent(S))}function Y(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:C(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:C(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:C(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:C(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function $(t){!1!==i.enabled&&t.preventDefault()}function q(t){delete _[t.pointerId];for(let e=0;e<w.length;e++)if(w[e].pointerId==t.pointerId)return void w.splice(e,1)}function X(t){let n=_[t.pointerId];void 0===n&&(n=new e.Vector2,_[t.pointerId]=n),n.set(t.pageX,t.pageY)}function Z(t){const e=t.pointerId===w[0].pointerId?w[1]:w[0];return _[e.pointerId]}i.domElement.addEventListener("contextmenu",$),i.domElement.addEventListener("pointerdown",V),i.domElement.addEventListener("pointercancel",K),i.domElement.addEventListener("wheel",W,{passive:!1}),this.update()}}let P=new T(r,a);P.traget=new e.Vector3(0,0,0),P.update();class O{constructor(t){this.name="string"==typeof x?t:"Undefined",this.x=0,this.y=0,this.w=0,this.h=0,this.pattern=[0,1,2,1,0,3,2,3]}set(t,e,n,i){this.x=isNaN(t)?this.x:t,this.y=isNaN(e)?this.y:e,this.w=isNaN(n)?this.w:n,this.h=isNaN(i)?this.h:i}UV(t){let e=[this.x/t.w,(t.h-this.y)/t.h,(this.x+this.w)/t.w,(t.h-this.y-this.h)/t.h];return[e[this.pattern[0]],e[this.pattern[1]],e[this.pattern[2]],e[this.pattern[3]],e[this.pattern[4]],e[this.pattern[5]],e[this.pattern[6]],e[this.pattern[7]]]}editPattern(t,e,n,i,s,r,o,a){let l=[this.pattern[t],this.pattern[e],this.pattern[n],this.pattern[i],this.pattern[s],this.pattern[r],this.pattern[o],this.pattern[a]];this.pattern=l}transform(t){t.translate&&(this.x+=isNaN(t.translate.x)?0:t.translate.x,this.y+=isNaN(t.translate.y)?0:t.translate.y)}get width(){return this.w}get height(){return this.h}}class D{constructor(t,e,n,i,s,r){this.north=t||new O("north"),this.south=e||new O("south"),this.east=n||new O("east"),this.west=i||new O("west"),this.up=s||new O("up"),this.down=r||new O("down")}setAll(t=0,e=0,n=0,i=0){this.north.set(t,e,n,i),this.south.set(t,e,n,i),this.east.set(t,e,n,i),this.west.set(t,e,n,i),this.up.set(t,e,n,i),this.down.set(t,e,n,i)}clone(t){let e=["north","south","east","west","up","down"];for(let n of e)this[n].x=t[n].x,this[n].y=t[n].y,this[n].w=t[n].w,this[n].h=t[n].h}}class C{constructor(){this.groups={}}addTileGroup(t,e){this.groups[t]=e}}const N={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222};let B={};for(var L in N)B[N[L]]=L;const U=new class{constructor(){this.eventManager=new v,this.eventManager.registerNativeEvent("keydown"),this.eventManager.on("keydown",this.handleKeyDown.bind(this)),this.eventManager.registerNativeEvent("keyup"),this.eventManager.on("keyup",this.handleKeyUp.bind(this)),this.registerKeyEvents(),this.eventManager.registerNativeEvent("blur"),this.eventManager.on("blur",this.handleBlur.bind(this))}registerKeyEvents(){for(let t in N)this.eventManager.registerEvent(`KEY_DOWN_${t}`),this.eventManager.registerEvent(`KEY_UP_${t}`),this.eventManager.registerEvent(`KEY_HELD_${t}`)}handleKeyUp(t){this.eventManager.emit(`KEY_UP_${B[t.keyCode]}`,{}),this.eventManager.breakLoop(`KEY_HELD_${B[t.keyCode]}`)}handleKeyDown(t){t.repeat||(this.eventManager.emit(`KEY_DOWN_${B[t.keyCode]}`,{}),this.eventManager.emit(`KEY_HELD_${B[t.keyCode]}`,{},!0))}onKey(t,e){this.checkValidKey(t,"onKey")&&this.eventManager.on(`KEY_HELD_${t}`,e)}onKeyDown(t,e){this.checkValidKey(t,"onKeyDown")&&this.eventManager.on(`KEY_DOWN_${t}`,e)}onKeyUp(t,e){this.checkValidKey(t,"onKeyUp")&&this.eventManager.on(`KEY_UP_${t}`,e)}getKey(t){if(this.checkValidKey(t,"getKey"))return this.eventManager.eventActive(`KEY_HELD_${t}`)}getKeyDown(t){if(this.checkValidKey(t,"getKeyDown"))return this.eventManager.eventActive(`KEY_DOWN_${t}`)}getKeyUp(t){if(this.checkValidKey(t,"getKeyUp"))return this.eventManager.eventActive(`KEY_UP_${t}`)}checkValidKey(t,e){return t in N||(f(`Keyboard.${e}(): '${t}' is not a valid key`),!1)}handleBlur(t){this.eventManager.clearQueue()}},R={L:0,M:1,R:2},I={0:"L",1:"M",2:"R"};const G=new class{constructor(){this.eventManager=new v,this.eventManager.registerNativeEvent("mousedown"),this.eventManager.on("mousedown",this.handleButtonDown.bind(this)),this.eventManager.registerNativeEvent("mouseup"),this.eventManager.on("mouseup",this.handleButtonUp.bind(this)),this.eventManager.registerNativeEvent("click"),this.eventManager.on("click",this.handleClick.bind(this)),this.eventManager.registerNativeEvent("mousemove"),this.eventManager.on("mousemove",this.handleMove.bind(this)),this.eventManager.registerNativeEvent("wheel"),this.eventManager.on("wheel",this.handleScroll.bind(this)),this.registerMouseEvents(),this.eventManager.registerNativeEvent("blur"),this.eventManager.on("blur",this.handleBlur.bind(this))}registerMouseEvents(){for(let t in R)this.eventManager.registerEvent(`MOUSE_DOWN_${t}`),this.eventManager.registerEvent(`MOUSE_UP_${t}`),this.eventManager.registerEvent(`MOUSE_CLICK_${t}`),this.eventManager.registerEvent(`MOUSE_HELD_${t}`);this.eventManager.registerEvent("MOUSE_SCROLL",!1,!0),this.eventManager.registerEvent("MOUSE_MOVE",!1,!0)}handleButtonUp(t){this.eventManager.emit(`MOUSE_UP_${I[t.button]}`,{}),this.eventManager.breakLoop(`MOUSE_HELD_${I[t.button]}`)}handleButtonDown(t){this.eventManager.emit(`MOUSE_DOWN_${I[t.button]}`,{}),this.eventManager.emit(`MOUSE_HELD_${I[t.button]}`,{},!0)}handleClick(t){this.eventManager.emit(`MOUSE_CLICK_${I[t.button]}`,{})}onButton(t,e){this.checkValidButton(t,"onButton")&&this.eventManager.on(`MOUSE_HELD_${t}`,e)}onButtonDown(t,e){this.checkValidButton(t,"onButtonDown")&&this.eventManager.on(`MOUSE_DOWN_${t}`,e)}onButtonUp(t,e){this.checkValidButton(t,"onButtonUp")&&this.eventManager.on(`MOUSE_UP_${t}`,e)}onClick(t,e){this.checkValidButton(t,"onClick")&&this.eventManager.on(`MOUSE_CLICK_${t}`,e)}getButton(t){if(this.checkValidButton(t,"getButton"))return this.eventManager.eventActive(`MOUSE_HELD_${t}`)}getButtonDown(t){if(this.checkValidButton(t,"getButtonDown"))return this.eventManager.eventActive(`MOUSE_DOWN_${t}`)}getButtonUp(t){if(this.checkValidButton(t,"getButtonUp"))return this.eventManager.eventActive(`MOUSE_UP_${t}`)}getClick(t){if(this.checkValidButton(t,"getClick"))return this.eventManager.eventActive(`MOUSE_CLICK_${t}`)}checkValidButton(t,e){return t in R||(f(`Mouse.${e}(): '${t}' is not a valid button`),!1)}handleScroll(t){this.eventManager.emit("MOUSE_SCROLL",{direction:Math.sign(t.deltaY)})}getScroll(){return this.eventManager.eventActive("MOUSE_SCROLL")}getScrollAmount(){return this.eventManager.getStore("MOUSE_SCROLL")}onScroll(t){this.eventManager.on("MOUSE_SCROLL",t)}handleMove(t){this.eventManager.emit("MOUSE_MOVE",{x:t.x,y:t.y})}onMove(t){this.eventManager.on("MOUSE_MOVE",t)}getMove(){return this.eventManager.eventActive("MOUSE_MOVE")}getPosition(){return this.eventManager.getStore("move")}handleBlur(t){this.eventManager.clearQueue()}},k=["GAMEPAD_LSTICK_NORTH","GAMEPAD_LSTICK_SOUTH","GAMEPAD_LSTICK_EAST","GAMEPAD_LSTICK_WEST","GAMEPAD_LSTICK_PRESS","GAMEPAD_RSTICK_NORTH","GAMEPAD_RSTICK_SOUTH","GAMEPAD_RSTICK_EAST","GAMEPAD_RSTICK_WEST","GAMEPAD_RSTICK_PRESS","GAMEPAD_DPAD_NORTH","GAMEPAD_DPAD_SOUTH","GAMEPAD_DPAD_EAST","GAMEPAD_DPAD_WEST","GAMEPAD_RTRIGGER_TOP","GAMEPAD_RTRIGGER_BOTTOM","GAMEPAD_LTRIGGER_TOP","GAMEPAD_LTRIGGER_BOTTOM","GAMEPAD_BUTTON_NORTH","GAMEPAD_BUTTON_SOUTH","GAMEPAD_BUTTON_EAST","GAMEPAD_BUTTON_WEST","GAMEPAD_BUTTON_START","GAMEPAD_BUTTON_SELECT"],z={0:"GAMEPAD_BUTTON_SOUTH",1:"GAMEPAD_BUTTON_EAST",2:"GAMEPAD_BUTTON_WEST",3:"GAMEPAD_BUTTON_NORTH",4:"GAMEPAD_RTRIGGER_TOP",5:"GAMEPAD_LTRIGGER_TOP",6:"GAMEPAD_RTRIGGER_BOTTOM",7:"GAMEPAD_LTRIGGER_BOTTOM",8:"GAMEPAD_BUTTON_SELECT",9:"GAMEPAD_BUTTON_START",10:"GAMEPAD_LSTICK_PRESS",11:"GAMEPAD_RSTICK_PRESS",12:"GAMEPAD_DPAD_NORTH",13:"GAMEPAD_DPAD_SOUTH",14:"GAMEPAD_DPAD_EAST",15:"GAMEPAD_DPAD_WEST"},j={0:["GAMEPAD_LSTICK_WEST","GAMEPAD_LSTICK_EAST"],1:["GAMEPAD_LSTICK_SOUTH","GAMEPAD_LSTICK_NORTH"],2:["GAMEPAD_RSTICK_WEST","GAMEPAD_RSTICK_EAST"],3:["GAMEPAD_RSTICK_SOUTH","GAMEPAD_RSTICK_NORTH"]};!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n.r(e);var i={events:{},publish:function(t,e){this.events.hasOwnProperty(t)&&this.events[t].forEach((t=>t(e)))},subscribe:function(t,e){return this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e),{unsubscribe:function(){this.events[t].splice(this.events[t].indexOf(e),1)}.bind(this)}}};const s="gamepadconnected",r="connect",o="gamepaddisconnected",a="disconnect",l="button_press",c="axis_move",h="left_stick",u={X:0,Y:1},d="right_stick",m={X:2,Y:3},p={button_0:0,button_1:1,button_2:2,button_3:3,button_4:4,button_5:5,button_6:6,button_7:7,button_8:8,button_9:9,button_10:10,button_11:11,button_12:12,button_13:13,button_14:14,button_15:15,button_16:16,button_17:17},g=t=>{console.warn&&"function"==typeof console.warn?console.warn(t):console.log(t)};var f={loopStarted:!1,instances:{},buttonEvents:{joypad:[]},settings:{axisMovementThreshold:.8},remove:function(t){return delete this.instances[t]},on:function(t,e){switch(t){case r:return i.subscribe(r,e);case a:return i.subscribe(a,e);case l:return i.subscribe(l,e);case c:return i.subscribe(c,e)}},vibrate:function(t,e){const{vibrationActuator:n}=t,i=e||this.settings.vibration;if((t=>!!(t&&t.type&&t.playEffect&&"function"==typeof t.playEffect))(n)){const{type:e}=n;return t.vibrationActuator.playEffect(e,i)}g("No vibration actuator interface found - https://developer.mozilla.org/en-US/docs/Web/API/GamepadHapticActuator")},set:function(t){const{axisMovementThreshold:e,vibration:n,customButtonMapping:i}=t,s=parseFloat(e);isNaN(s)||(this.settings.axisMovementThreshold=s),this.settings.vibration=n,this.settings.customButtonMapping=i},trigger:function(t,e){return i.publish(t,e)}},v={id:null,start:function(){const t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,{buttonEvents:e}=f;let n=window.navigator.getGamepads();(n=Array.prototype.slice.call(n)).forEach(((t,n)=>{t&&(e.joypad[n]||(e.joypad[n]={}),f.instances[n]=t,b(t),E(t))})),e.joypad.forEach((t=>{t&&Object.keys(t).forEach((e=>{y(e,t)}))})),this.id=t(this.start.bind(this))},stop:function(t){return(window.cancelAnimationFrame||window.webkitCancelAnimationFrame)(t)}};const b=t=>{t.buttons.forEach(((e,n)=>{const{customButtonMapping:i}=f.settings,s=((t,e)=>{let n=[];return Object.keys(e).forEach((i=>{(e[i]===t||Array.isArray(e[i])&&-1!==e[i].indexOf(t))&&n.push(i)})),n})(n,i||p),{buttonEvents:r}=f;s&&s.length&&s.forEach((i=>{e.pressed?(r.joypad[t.index][i]||(r.joypad[t.index][i]={pressed:!0,hold:!1,released:!1}),r.joypad[t.index][i].button=e,r.joypad[t.index][i].index=n,r.joypad[t.index][i].gamepad=t):!e.pressed&&r.joypad[t.index][i]&&(r.joypad[t.index][i].released=!0,r.joypad[t.index][i].hold=!1)}))}))},E=t=>{const{axisMovementThreshold:e}=f.settings,{axes:n}=t,i=n.length/2;n.forEach(((n,s)=>{if(Math.abs(n)>e){let e=null,r=null,o=n;e=s<i?h:d,s!==u.X&&s!==m.X||(r=n<0?"left":"right"),s!==u.Y&&s!==m.Y||(r=n<0?"top":"bottom");const a={gamepad:t,totalSticks:i,stickMoved:e,directionOfMovement:r,axisMovementValue:o,axis:s};return window.dispatchEvent((t=>new CustomEvent(c,{detail:t}))(a))}}))},y=(t,e)=>{if(e[t].pressed){const n=t=>new CustomEvent(l,{detail:t}),{index:i,gamepad:s}=e[t],r={buttonName:t,button:e[t].button,index:i,gamepad:s};window.dispatchEvent(n(r)),e[t].pressed=!1,e[t].hold=!0}else e[t].hold||e[t].released&&delete e[t]};window.addEventListener(s,(t=>{if(i.publish(r,t),!f.loopStarted)return f.loopStarted=!0,v.start()})),window.addEventListener(o,(t=>{if(i.publish(a,t),f.remove(t.gamepad.index),f.buttonEvents.joypad[t.gamepad.index]=null,!Object.keys(f.instances).length)return f.loopStarted=!1,v.stop(v.id)})),window.addEventListener(l,(t=>i.publish(l,t))),window.addEventListener(c,(t=>i.publish(c,t))),window.navigator.getGamepads&&"function"==typeof window.navigator.getGamepads?window.joypad=f:(window.joypad={},g("Your browser does not support the Gamepad API - https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API"))}]);let V=window.joypad;delete window.joypad;const H=new class{constructor(){this.eventManager=new v,V.set({axisMovementThreshold:.3}),V.on("connect",this.handleConnect.bind(this)),V.on("disconnect",this.handleDisconnect.bind(this)),V.on("axis_move",this.handleAxisMove.bind(this)),V.on("button_press",this.handleButtonPress.bind(this)),this.registerEvents()}registerEvents(){for(let t of k)this.eventManager.registerEvent(t)}handleConnect(t){}handleDisconnect(t){}handleAxisMove(t){let e="left"==t.detail.directionOfMovement||"bottom"==t.detail.directionOfMovement?0:1;this.eventManager.emit(j[t.detail.axis][e])}handleButtonPress(t){this.eventManager.emit(z[t.detail.index])}};var F=Object.freeze({__proto__:null,Keyboard:U,Mouse:G,Gamepad:H});let K=new class{constructor(){this.XAxis=Object.freeze(new e.Vector3(1,0,0)),this.YAxis=Object.freeze(new e.Vector3(0,1,0)),this.ZAxis=Object.freeze(new e.Vector3(0,0,1)),this.NAxis=Object.freeze(new e.Vector3(0,0,0)),this.North=Object.freeze(new e.Vector3(0,0,-1)),this.South=Object.freeze(new e.Vector3(0,0,1)),this.East=Object.freeze(new e.Vector3(1,0,0)),this.West=Object.freeze(new e.Vector3(-1,0,0)),this.Up=Object.freeze(new e.Vector3(0,1,0)),this.Down=Object.freeze(new e.Vector3(0,-1,0))}generateUUID(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);var n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]).toUpperCase()}};class W{constructor(t,n=new e.Vector3(0,0,0),i=0){this.collider=t,this.position=n,this.center=n,this.radius=i,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4}intersectsSphere(t){let e=this.radius+t.radius;return t.position.distanceToSquared(this.position)<=e*e}update(){this.matrix.setPosition(this.center)}updateWorldMatrix(){this.collider?(this.matrixWorld.multiplyMatrices(this.collider.entity.matrix,this.matrix),this.position=this.center.clone().applyMatrix4(this.collider.entity.matrix)):this.matrixWorld.copy(this.matrix)}}const Y={c:null,u:[new e.Vector3,new e.Vector3,new e.Vector3],e:[]},$={c:null,u:[new e.Vector3,new e.Vector3,new e.Vector3],e:[]},q=[[],[],[]],X=[[],[],[]],Z=[];let Q=0,J=0,tt=1/0;const et=new e.Vector3,nt=new e.Vector3,it=new e.Vector3,st=new e.Vector3,rt=new e.Vector3,ot=new e.Vector3,at=new e.Vector3,lt=new e.Matrix3,ct=new e.Box3,ht=new e.Matrix4,ut=new e.Matrix4,dt=new e.Ray;class mt{constructor(t=new e.Vector3,n=new e.Vector3,i=new e.Matrix3){this.center=t,this.halfSize=n,this.rotation=i}set(t,e,n){return this.center=t,this.halfSize=e,this.rotation=n,this}copy(t){return this.center.copy(t.center),this.halfSize.copy(t.halfSize),this.rotation.copy(t.rotation),this}clone(){return(new this.constructor).copy(this)}getSize(t){return t.copy(this.halfSize).multiplyScalar(2)}clampPoint(t,n){const i=this.halfSize;st.subVectors(t,this.center),this.rotation.extractBasis(et,nt,it),n.copy(this.center);const s=e.MathUtils.clamp(st.dot(et),-i.x,i.x);n.add(et.multiplyScalar(s));const r=e.MathUtils.clamp(st.dot(nt),-i.y,i.y);n.add(nt.multiplyScalar(r));const o=e.MathUtils.clamp(st.dot(it),-i.z,i.z);return n.add(it.multiplyScalar(o)),n}containsPoint(t){return st.subVectors(t,this.center),this.rotation.extractBasis(et,nt,it),Math.abs(st.dot(et))<=this.halfSize.x&&Math.abs(st.dot(nt))<=this.halfSize.y&&Math.abs(st.dot(it))<=this.halfSize.z}intersectsBox3(t){return this.intersectsOBB(pt.fromBox3(t))}intersectsSphere(t){return this.clampPoint(t.center,at),at.distanceToSquared(t.center)<=t.radius*t.radius}intersectsOBB(t){tt=1/0,ot.set(0,0,0),Y.c=this.center,Y.e[0]=this.halfSize.x,Y.e[1]=this.halfSize.y,Y.e[2]=this.halfSize.z,this.rotation.extractBasis(Y.u[0],Y.u[1],Y.u[2]),$.c=t.center,$.e[0]=t.halfSize.x,$.e[1]=t.halfSize.y,$.e[2]=t.halfSize.z,t.rotation.extractBasis($.u[0],$.u[1],$.u[2]);for(let t=0;t<3;t++)for(let e=0;e<3;e++)q[t][e]=Y.u[t].dot($.u[e]),X[t][e]=Math.abs(q[t][e])+.001;let e,n;st.subVectors($.c,Y.c),Z[0]=st.dot(Y.u[0]),Z[1]=st.dot(Y.u[1]),Z[2]=st.dot(Y.u[2]);for(let t=0;t<3;t++){if(e=Y.e[t],n=$.e[0]*X[t][0]+$.e[1]*X[t][1]+$.e[2]*X[t][2],Math.abs(Z[t])>e+n)return!1;Q=Z[t],J=Math.abs(Q)-(e+n),Math.abs(J)<Math.abs(tt)&&(tt=J,0!=Math.sign(Q)&&(tt*=Math.sign(Q)),ot.copy(Y.u[t]))}for(let t=0;t<3;t++){if(e=Y.e[0]*X[0][t]+Y.e[1]*X[1][t]+Y.e[2]*X[2][t],n=$.e[t],Math.abs(Z[0]*q[0][t]+Z[1]*q[1][t]+Z[2]*q[2][t])>e+n)return!1;Q=Z[0]*q[0][t]+Z[1]*q[1][t]+Z[2]*q[2][t],J=Math.abs(Q)-(e+n),Math.abs(J)<Math.abs(tt)&&(tt=J,0!=Math.sign(Q)&&(tt*=Math.sign(Q)),ot.copy($.u[t]))}return e=Y.e[1]*X[2][0]+Y.e[2]*X[1][0],n=$.e[1]*X[0][2]+$.e[2]*X[0][1],!(Math.abs(Z[2]*q[1][0]-Z[1]*q[2][0])>e+n)&&(e=Y.e[1]*X[2][1]+Y.e[2]*X[1][1],n=$.e[0]*X[0][2]+$.e[2]*X[0][0],!(Math.abs(Z[2]*q[1][1]-Z[1]*q[2][1])>e+n)&&(e=Y.e[1]*X[2][2]+Y.e[2]*X[1][2],n=$.e[0]*X[0][1]+$.e[1]*X[0][0],!(Math.abs(Z[2]*q[1][2]-Z[1]*q[2][2])>e+n)&&(e=Y.e[0]*X[2][0]+Y.e[2]*X[0][0],n=$.e[1]*X[1][2]+$.e[2]*X[1][1],!(Math.abs(Z[0]*q[2][0]-Z[2]*q[0][0])>e+n)&&(e=Y.e[0]*X[2][1]+Y.e[2]*X[0][1],n=$.e[0]*X[1][2]+$.e[2]*X[1][0],!(Math.abs(Z[0]*q[2][1]-Z[2]*q[0][1])>e+n)&&(e=Y.e[0]*X[2][2]+Y.e[2]*X[0][2],n=$.e[0]*X[1][1]+$.e[1]*X[1][0],!(Math.abs(Z[0]*q[2][2]-Z[2]*q[0][2])>e+n)&&(e=Y.e[0]*X[1][0]+Y.e[1]*X[0][0],n=$.e[1]*X[2][2]+$.e[2]*X[2][1],!(Math.abs(Z[1]*q[0][0]-Z[0]*q[1][0])>e+n)&&(e=Y.e[0]*X[1][1]+Y.e[1]*X[0][1],n=$.e[0]*X[2][2]+$.e[2]*X[2][0],!(Math.abs(Z[1]*q[0][1]-Z[0]*q[1][1])>e+n)&&(e=Y.e[0]*X[1][2]+Y.e[1]*X[0][2],n=$.e[0]*X[2][1]+$.e[1]*X[2][0],!(Math.abs(Z[1]*q[0][2]-Z[0]*q[1][2])>e+n)&&[ot,tt]))))))))}intersectsPlane(t){this.rotation.extractBasis(et,nt,it);const e=this.halfSize.x*Math.abs(t.normal.dot(et))+this.halfSize.y*Math.abs(t.normal.dot(nt))+this.halfSize.z*Math.abs(t.normal.dot(it)),n=t.normal.dot(this.center)-t.constant;return Math.abs(n)<=e}intersectRay(t,e){return this.getSize(rt),ct.setFromCenterAndSize(st.set(0,0,0),rt),ht.setFromMatrix3(this.rotation),ht.setPosition(this.center),ut.copy(ht).invert(),dt.copy(t).applyMatrix4(ut),dt.intersectBox(ct,e)?e.applyMatrix4(ht):null}intersectsRay(t){return null!==this.intersectRay(t,st)}fromBox3(t){return t.getCenter(this.center),t.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(t){return t.center.equals(this.center)&&t.halfSize.equals(this.halfSize)&&t.rotation.equals(this.rotation)}applyMatrix4(t){const e=t.elements;let n=st.set(e[0],e[1],e[2]).length();const i=st.set(e[4],e[5],e[6]).length(),s=st.set(e[8],e[9],e[10]).length();t.determinant()<0&&(n=-n),lt.setFromMatrix4(t);const r=1/n,o=1/i,a=1/s;return lt.elements[0]*=r,lt.elements[1]*=r,lt.elements[2]*=r,lt.elements[3]*=o,lt.elements[4]*=o,lt.elements[5]*=o,lt.elements[6]*=a,lt.elements[7]*=a,lt.elements[8]*=a,this.rotation.multiply(lt),this.halfSize.x*=n,this.halfSize.y*=i,this.halfSize.z*=s,st.setFromMatrixPosition(t),this.center.add(st),this}}const pt=new mt;class gt{constructor(t){this.collider=t,this.epsilon=.001,this.position=new e.Vector3,this.rotation=new e.Euler,this.scale=new e.Vector3,this.obb=new mt,this.center=new e.Vector3,this.basis=new e.Matrix4,this.halfWidth=new e.Vector3,this.quaternion=new e.Quaternion,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4}getBoundingBox(){return(new e.Box3).setFromCenterAndSize(this.position,this.scale).applyMatrix4((new e.Matrix4).makeRotationFromEuler(this.rotation))}fromBoundingBox(t){t.getCenter(this.position),t.getSize(this.scale),this.update()}set(t,n,i){t&&(this.position=t),i&&(this.scale=i),n instanceof e.Vector3?this.rotation.setFromVector3(n):n instanceof e.Euler&&this.rotation.copy(n)}update(){this.quaternion.setFromEuler(this.rotation,!1),this.matrix.compose(this.position,this.quaternion,this.scale),this.updateWorldMatrix(),this.center.setFromMatrixPosition(this.matrixWorld),this.collider&&this.basis.makeRotationFromEuler(this.collider.entity.rotation),this.halfWidth.copy(this.scale).multiplyScalar(.5),this.obb.set(this.center,this.halfWidth,this.basis)}updateWorldMatrix(){this.collider?this.matrixWorld.multiplyMatrices(this.collider.entity.matrix,this.matrix):this.matrixWorld.copy(this.matrix)}intersectsOBB(t){let e=this.obb.intersectsOBB(t.obb);return!!e&&e[0].multiplyScalar(e[1])}}class ft{constructor(t){this.entity=t,this.boundingSphere=new W(this),this.boundingBox=new gt(this),this.collision=[],this.debugger=null,this.update()}fromTemplate(t){this.collision=t.collision;for(let t of this.collision)t.collider=this;this.boundingBox=t.boundingBox,this.boundingBox.collider=this,this.boundingSphere=t.boundingSphere,this.boundingSphere.collider=this}isColliding(t){return!!this.boundingSphere.intersectsSphere(t.boundingSphere)&&this.boundingBox.intersectsOBB(t.boundingBox)}addBox(t){this.collision.push(t)}update(){for(let t of this.collision)t.updateWorldMatrix();this.boundingBox.update(),this.boundingSphere.updateWorldMatrix()}}let vt=document.createElement("div");vt.style="\n\tposition: absolute;\n\ttop: 0;\n\tcolor: #FFF;\n",vt.id="PANIC-Debug",o.appendChild(vt);let bt=new class{constructor(){this.id="PANIC-Debug-Text",this.element=document.createElement("div"),this.element.id=this.id,this.active=!1,this.state=0}toggle(t=null){this.active="boolean"==typeof t?!t:!this.active,this.active?vt.appendChild(this.element):vt.removeChild(this.element)}set(t){this.element.innerHTML=`${t}`}};class Et{constructor(t){this.uuid=K.generateUUID(),this.template=t,this.position=new e.Vector3(0,0,0),this.rotation=new e.Euler(0,0,0),this.scale=new e.Vector3(1,1,1),this.quaternion=new e.Quaternion,this.matrix=new e.Matrix4,this.skeleton=new e.Skeleton,this.mesh=new e.Mesh(this.template.geometry,this.template.material),this.mesh.matrixAutoUpdate=!1,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.frustumCulled=!1,this.mesh.customDepthMaterial=new e.MeshDepthMaterial({depthPacking:e.RGBADepthPacking,map:this.template.texture,alphaTest:.5}),i.add(this.mesh),this.collider=new ft(this),this.collider.fromTemplate(this.template.collider),this.actions=this.template.actions,this.actions.eventManager.binding=this,this.actions.eventManager.hasEvent("INIT")&&this.actions.eventManager.emit("INIT"),this.store={},this.debug=null,d.add(this)}update(){this.actions.eventManager.hasEvent("UPDATE")&&this.actions.eventManager.emit("UPDATE"),this.debug&&this.debug.update(),this.quaternion.setFromEuler(this.rotation,!1),this.matrix.compose(this.position,this.quaternion,this.scale),this.collider.update(),this.checkCollision(),this.mesh.matrix.copy(this.matrix)}checkCollision(){new e.Vector3,new e.Vector3;for(const[t,e]of Object.entries(PANIC.EntityRegistry.entities))if(this.uuid!=t&&this.actions.eventManager.hasEvent("COLLIDE")){let t=this.collider.isColliding(e.collider);t&&(this.position.add(t.multiplyScalar(.5)),e.position.add(t.multiplyScalar(-.5)),this.actions.eventManager.emit("COLLIDE"),e.actions.eventManager.emit("COLLIDE"))}}}let yt={uniforms:e.ShaderLib.lambert.uniforms,vertex:"\n\n\t\t#define LAMBERT\n\n\t\tvarying vec3 vLightFront;\n\t\tvarying vec3 vIndirectFront;\n\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvarying vec3 vLightBack;\n\t\t\tvarying vec3 vIndirectBack;\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <uv_pars_vertex>\n\t\t#include <uv2_pars_vertex>\n\t\t#include <envmap_pars_vertex>\n\t\t#include <bsdfs>\n\t\t#include <lights_pars_begin>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <morphtarget_pars_vertex>\n\t\t#include <skinning_pars_vertex>\n\t\t#include <shadowmap_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#include <uv_vertex>\n\t\t\t#include <uv2_vertex>\n\t\t\t#include <color_vertex>\n\n\t\t\t#include <beginnormal_vertex>\n\t\t\t#include <morphnormal_vertex>\n\t\t\t#include <skinbase_vertex>\n\t\t\t#include <skinnormal_vertex>\n\t\t\t#include <defaultnormal_vertex>\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <morphtarget_vertex>\n\t\t\t#include <skinning_vertex>\n\t\t\t#include <project_vertex>\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <envmap_vertex>\n\t\t\t#include <lights_lambert_vertex>\n\t\t\t#include <shadowmap_vertex>\n\t\t\t#include <fog_vertex>\n\t\t}\n\t",fragment:"\n\t\tuniform vec3 diffuse;\n\t\tuniform vec3 emissive;\n\t\tuniform float opacity;\n\n\t\tvarying vec3 vLightFront;\n\t\tvarying vec3 vIndirectFront;\n\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvarying vec3 vLightBack;\n\t\t\tvarying vec3 vIndirectBack;\n\t\t#endif\n\n\n\t\t#include <common>\n\t\t#include <packing>\n\t\t#include <dithering_pars_fragment>\n\t\t#include <color_pars_fragment>\n\t\t#include <uv_pars_fragment>\n\t\t#include <uv2_pars_fragment>\n\t\t#include <map_pars_fragment>\n\t\t#include <alphamap_pars_fragment>\n\t\t#include <alphatest_pars_fragment>\n\t\t#include <aomap_pars_fragment>\n\t\t#include <lightmap_pars_fragment>\n\t\t#include <emissivemap_pars_fragment>\n\t\t#include <envmap_common_pars_fragment>\n\t\t#include <envmap_pars_fragment>\n\t\t#include <cube_uv_reflection_fragment>\n\t\t#include <bsdfs>\n\t\t#include <lights_pars_begin>\n\t\t#include <fog_pars_fragment>\n\t\t#include <shadowmap_pars_fragment>\n\t\t#include <shadowmask_pars_fragment>\n\t\t#include <specularmap_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\t\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t\t\tvec3 totalEmissiveRadiance = emissive;\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <map_fragment>\n\t\t\t#include <color_fragment>\n\t\t\t#include <alphamap_fragment>\n\t\t\t#include <alphatest_fragment>\n\t\t\t#include <specularmap_fragment>\n\t\t\t#include <emissivemap_fragment>\n\n\t\t\t// accumulation\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t\t\t#else\n\n\t\t\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t\t\t#endif\n\n\t\t\t#include <lightmap_fragment>\n\n\t\t\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t\t\t#else\n\n\t\t\t\treflectedLight.directDiffuse = vLightFront;\n\n\t\t\t#endif\n\n\t\t\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t\t\t// modulation\n\n\t\t\t#include <aomap_fragment>\n\n\t\t\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t\t\t#include <envmap_fragment>\n\n\t\t\t#include <output_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <dithering_fragment>\n\n\t\t}\n\t"};class wt{constructor(){this.id="unknown",this.name="Unknown",this.texture=null,this.tileset=null,this.bones=[],this.geometry=null,this.collider=null,this.actions=null,this.shader=yt,this.uniforms=null,this.material=null}setup(){this.uniforms=e.UniformsUtils.clone(this.shader.uniforms),this.material=new e.ShaderMaterial({defines:{USE_MAP:"",DOUBLE_SIDED:""},uniforms:this.uniforms,vertexShader:this.shader.vertex,fragmentShader:this.shader.fragment,lights:!0,fog:!0,transparent:!0}),this.uniforms.alphaTest=new e.Uniform(.5),this.material.alphaTest=!0,this.uniforms.map=new e.Uniform(this.texture),this.material.map=this.texture,this.material.side=e.DoubleSide,this.material.shadowSide=e.DoubleSide}spawnEntity(){return this.actions.eventManager.active||(this.actions.eventManager.active=!0),new Et(this)}}let _t=new class{constructor(){this.data=[],this.entities={}}getEntityByName(t){return this.data.find((e=>e.name==t))}getEntityByID(t){return this.data.find((e=>e.id==t))}registerEntity(t){null==this.getEntityByID(t.id)?this.data.push(t):f('Entity "'+entity.id+'" is already registered')}unregisterEntity(t){null!=this.getEntityByID(template.id)&&this.getEntityByID(template.id)}spawnEntity(t){if(null!=this.getEntityByID(t)){let e=this.getEntityByID(t).spawnEntity();return this.entities[e.uuid]=e}}};class Mt{constructor(){this.boundingSphere=new W,this.boundingBox=new gt,this.collision=[]}addBox(t){this.collision.push(t)}generate(){let t=new e.Vector3(1/0,1/0,1/0),n=new e.Vector3(-1/0,-1/0,-1/0),i=new e.Vector3;for(let s of this.collision){let r=new Float32Array([.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5]),o=new e.BufferAttribute(r,3);o.applyMatrix4(s.matrix);for(let e=0;e<8;e++)i.fromBufferAttribute(o,e),t.min(i),n.max(i)}this.boundingBox.position.addVectors(t,n).multiplyScalar(.5),this.boundingBox.scale.subVectors(n,t),this.boundingBox.update(),this.boundingSphere.center.copy(this.boundingBox.position),this.boundingSphere.radius=this.boundingSphere.center.distanceTo(t)>this.boundingSphere.center.distanceTo(n)?this.boundingSphere.center.distanceTo(t):this.boundingSphere.center.distanceTo(n),this.boundingSphere.update()}generateCollider(t){return new ft.fromTemplate(this,t)}}var At=Object.freeze({__proto__:null,EntityCollider:ft,EntityColliderTemplate:Mt,BoundingSphere:W});let xt={uniforms:{uDistance:{value:100}},vertex:"\n\n\t\tuniform float uDistance;\n\n\t\tattribute float opacity;\n\n\t\tvarying vec3 vColor;\n\t\tvarying float vOpacity;\n\t\tvarying vec3 worldPosition;\n\n\t\tvoid main() {\n\n\t\t\tvColor.xyz = color.xyz;\n\t\t\tvOpacity = opacity;\n\n\t\t\tvec3 transformed = position.xzy * ( uDistance + distance( cameraPosition.xyz, worldPosition.xyz ) );\n\n\t\t\tworldPosition = transformed;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n\n\t\t}\n\n\t",fragment:"\n\n\t\tuniform float uDistance;\n\n\t\tvarying vec3 vColor;\n\t\tvarying float vOpacity;\n\t\tvarying vec3 worldPosition;\n\n\t\tvoid main() {\n\n\t\t\tfloat d = 1.0 - min( distance( cameraPosition.xyz, worldPosition.xyz ) / uDistance, 1.0 );\n\n\t\t\tgl_FragColor = vec4( vColor, vOpacity * pow( d, 3.0 ) );\n\n\t\t\tif ( gl_FragColor.a <= 0.0 ) discard;\n\n\t\t}\n\n\t"},St={uniforms:{uColor:{value:new e.Color(0)},uScale:{value:1},uSubdivisions:{value:1},uDistance:{value:1}},vertex:"\n\n\t\tuniform float uDistance;\n\n\t\tvarying vec3 worldPosition;\n\n\t\tvoid main() {\n\n\t\t\tvec3 pos = position.xzy * uDistance;\n\t\t\tpos.xz += cameraPosition.xz;\n\n\t\t\tworldPosition = pos;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n\t\t}\n\n\t",fragment:"\n\n\t\tuniform float uScale;\n\t\tuniform float uSubdivisions;\n\t\tuniform vec3 uColor;\n\t\tuniform float uDistance;\n\n\t\tvarying vec3 worldPosition;\n\n\t\tfloat getGrid( float size ) {\n\n\t\t\t vec2 r = worldPosition.xz / size;\n\n\t\t\t vec2 grid = abs( fract( r - 0.5 ) - 0.5 ) / fwidth( r );\n\t\t\t float line = min( grid.x, grid.y );\n\n\t\t\t return 1.0 - min( line, 1.0 );\n\n\t\t }\n\n\t\t void main() {\n\n\t\t\t   float d = 1.0 - min( distance( cameraPosition.xyz, worldPosition.xyz ) / uDistance, 1.0 );\n\n\t\t\t   float g1 = getGrid( uScale / uSubdivisions );\n\t\t\t   float g2 = getGrid( uScale );\n\n\t\t\t   gl_FragColor = vec4( uColor.rgb, mix( g2, g1, g1 ) * pow( d, 3.0 ) );\n\t\t\t   gl_FragColor.a = mix( 0.5 * gl_FragColor.a, gl_FragColor.a, g2 );\n\n\t\t\t   if ( gl_FragColor.a <= 0.0 ) discard;\n\n\t\t}\n\t"};var Tt=Object.freeze({__proto__:null,DebugAxes:xt,DebugGrid:St,Entity:yt});let Pt=new function(){this.loader=new e.FileLoader,this.load=async function(t){return await new Promise((e=>{this.loader.load(t,e)}))}},Ot=new function(){this.load=async function(t){return await new Promise((e=>{let n=new Image;n.addEventListener("load",(()=>{e(n)})),n.src=t}))}},Dt=new function(){this.load=async function(t){let e=await Ot.load(t);return new _(e)}},Ct=new function(){this.parse=function(t){return window.JSON.parse(t)}},Nt=new function(){this.parse=function(t,e="Undefined"){let n=new C,i=Object.entries(t);console.groupCollapsed(`Tileset: '${e}'`);for(let[t,e]of i)if(this.isGroup(e)){g(`'${t}' is a group`);let i=this.parseGroup(e,n);n.addTileGroup(t,i)}else g(`'${t}' is unknown`);return console.groupEnd(),n},this.isTile=function(t){for(let e in t)if(("t"==e||"transform"==e)&&"number"==typeof t[e])return!0;return!0},this.parseTile=function(t){},this.isGroup=function(t){let e=["all","default","clone","transform","north","south","east","west","up","down"],n=Object.entries(t);for(let[t,i]of n){if(!e.includes(t))return!1;if(!this.isTile(i))return!1}return!0},this.parseGroup=function(t,e){let n=new D,i=["north","south","east","west","up","down"];t.clone?n.clone(e.groups[t.clone]):t.all&&n.setAll(t.all.x,t.all.y,t.all.w,t.all.h);for(let e of i)if(t[e]){t.default&&n[e].set(t.default.x,t.default.y,t.default.w,t.default.h);let i=t[e];isNaN(i.x)||(n[e].x=i.x),isNaN(i.y)||(n[e].y=i.y),isNaN(i.w)||(n[e].w=i.w),isNaN(i.h)||(n[e].h=i.h),i.t&&(i.t.flipX&&n[e].editPattern(2,3,0,1,6,7,4,5),i.t.flipY&&n[e].editPattern(4,5,6,7,0,1,2,3),i.t.translate&&(i.t.translate.x&&(n[e].x+=i.t.translate.x),i.t.translate.y&&(n[e].y+=i.t.translate.y)),i.t.rotate&&(1==i.t.rotate?n[e].editPattern(4,5,0,1,6,7,2,3):2==i.t.rotate?n[e].editPattern(6,7,4,5,2,3,0,1):3==i.t.rotate&&n[e].editPattern(2,3,6,7,0,1,4,5)))}if(t.transform)for(let e of i)n[e]&&(t.transform.translate.x&&(n[e].x+=t.transform.translate.x),t.transform.translate.y&&(n[e].y+=t.transform.translate.y));return n}},Bt=new function(){this.parse=function(t,e,n,i){let s=["east","west","up","down","south","north"],r=i.groups[t];for(var o=0;o<6;o++)if(r[s[o]]){let t=r[s[o]].UV(n);e.attributes.uv.array.set([t[0],t[1]],8*o+0),e.attributes.uv.array.set([t[2],t[3]],8*o+2),e.attributes.uv.array.set([t[4],t[5]],8*o+4),e.attributes.uv.array.set([t[6],t[7]],8*o+6)}}};function Lt(t){let n,i,s,r=0;for(let e=0;e<t.length;++e){const o=t[e];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===n&&(n=o.array.constructor),n!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=o.itemSize),i!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===s&&(s=o.normalized),s!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=o.array.length}const o=new n(r);let a=0;for(let e=0;e<t.length;++e)o.set(t[e].array,a),a+=t[e].array.length;return new e.BufferAttribute(o,i,s)}let Ut=new function(){this.parse=function(t,n){new e.BufferGeometry;let i=[],s=Object.entries(t);for(let[t,r]of s)if(r.cubes)for(let t of r.cubes){let s=new w(1,1,1),r=new e.Matrix4,o=new e.Vector3(1,1,1),a=new e.Vector3(0,0,0),l=new e.Euler(0,0,0);t.size&&o.set(t.size[0],t.size[1],t.size[2]).divideScalar(16).clampScalar(1e-8,Math.min()),t.offset&&a.set(t.offset[0],t.offset[1],t.offset[2]).divideScalar(16),t.rotation&&l.setFromVector3(new e.Vector3(t.rotation[0],t.rotation[1],t.rotation[2]).multiplyScalar(Math.PI/180));let c=(new e.Quaternion).setFromEuler(l,!1);r.compose(a,c,o),s.applyMatrix4(r),t.faces&&Bt.parse(t.faces,s,n.texture,n.tileset),i.push(s)}return function(t,n=!1){const i=null!==t[0].index,s=new Set(Object.keys(t[0].attributes)),r=new Set(Object.keys(t[0].morphAttributes)),o={},a={},l=t[0].morphTargetsRelative,c=new e.BufferGeometry;let h=0;for(let e=0;e<t.length;++e){const u=t[e];let d=0;if(i!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+e+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in u.attributes){if(!s.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+e+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[t]&&(o[t]=[]),o[t].push(u.attributes[t]),d++}if(d!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+e+". Make sure all geometries have the same number of attributes."),null;if(l!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+e+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in u.morphAttributes){if(!r.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+e+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[t]&&(a[t]=[]),a[t].push(u.morphAttributes[t])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(u.userData),n){let t;if(i)t=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+e+". The geometry must have either an index or a position attribute"),null;t=u.attributes.position.count}c.addGroup(h,t,e),h+=t}}if(i){let e=0;const n=[];for(let i=0;i<t.length;++i){const s=t[i].index;for(let t=0;t<s.count;++t)n.push(s.getX(t)+e);e+=t[i].attributes.position.count}c.setIndex(n)}for(const t in o){const e=Lt(o[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;c.setAttribute(t,e)}for(const t in a){const e=a[t][0].length;if(0===e)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[t]=[];for(let n=0;n<e;++n){const e=[];for(let i=0;i<a[t].length;++i)e.push(a[t][i][n]);const i=Lt(e);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" morphAttribute."),null;c.morphAttributes[t].push(i)}}return c}(i)},this.setupSkinning=function(t,n){for(var i=new Float32Array(t.attributes.position.count),s=0;s<i.length;s++)i.set([n],s);t.setAttribute("skinIndices",new e.BufferAttribute(i,1))}},Rt=new function(){},It=new function(){this.parse=function(t){let n=new Mt;for(const[i,s]of Object.entries(t.boxes)){let t=new gt;s.size&&t.scale.set(s.size[0]/16,s.size[1]/16,s.size[2]/16),s.offset&&t.position.set(s.offset[0]/16,s.offset[1]/16,s.offset[2]/16),s.rotation&&t.rotation.setFromVector3(new e.Vector3(s.rotation[0],s.rotation[1],s.rotation[2]).multiplyScalar(Math.PI/180)),t.update(),n.addBox(t)}return n.generate(),n}};class Gt{constructor(){this.eventManager=new v,this.eventManager.active=!1}registerAction(t){this.eventManager.registerEvent(t)}addInputBinding(t,e){e.startsWith("KEY")?U.eventManager.on(e,(()=>{this.eventManager.emit(t)})):e.startsWith("MOUSE")?G.eventManager.on(e,(()=>{this.eventManager.emit(t)})):e.startsWith("GAMEPAD")&&H.eventManager.on(e,(()=>{this.eventManager.emit(t)}))}on(t,e){this.eventManager.on(t,e)}}let kt=new function(){this.load=async function(t){return await Pt.load(t)}};let zt=new class{consturctor(){}async parse(t,e,n){let i=new Gt;for(const[e,s]of Object.entries(t))if("bindings"!=e){i.registerAction(e);let t=await kt.load(n+s);i.on(e,new Function(t)())}for(const[t,n]of Object.entries(e))for(let e of n)i.addInputBinding(t,e);return i}};var jt=Object.freeze({__proto__:null,JSON:Ct,Tileset:Nt,CubeUV:Bt,EntityModel:Ut,EntityArmature:Rt,Collision:It,Actions:zt});let Vt=new function(){this.load=async function(t){let e=t.substring(0,t.lastIndexOf("/")+1),n=await Pt.load(t),i=await Ct.parse(n),s=new wt;return s.id=i.id,s.name=i.name,i.actions?s.actions=await zt.parse(i.actions,i.bindings,e):s.actions=new Gt,i.collision&&(s.collider=await It.parse(i.collision)),s.texture=await Dt.load(e+i.texture),s.tileset=await Nt.parse(i.tileset,i.id),s.geometry=await Ut.parse(i.armature,s),s.setup(),_t.registerEntity(s),s}};var Ht=Object.freeze({__proto__:null,File:Pt,Image:Ot,Texture:Dt,Entity:Vt,ActionScript:kt});let Ft=new class{constuctor(){this.THREE=void 0}async enable(){p&&(null==this.THREE&&(this.THREE=await import("three")),window.THREE!=this.THREE?(window.THREE=this.THREE,PANIC.Debug.warn("[PANIC] Namespace 'THREE' has been made global")):PANIC.Debug.error("[PANIC] Namespace 'THREE' is already global"))}disable(){p&&(null!=this.THREE&&window.THREE==this.THREE?(window.THREE=void 0,PANIC.Debug.warn("[PANIC] Namespace 'THREE' has been made private")):PANIC.Debug.error("[PANIC] Namespace 'THREE' is already private"))}toggle(){window.THREE!=this.THREE?this.enable():this.disable()}};let Kt=new class{constuctor(){this.isGlobal=!1}async enable(){p&&(this.isGlobal?PANIC.Debug.warn("[PANIC] Namespace 'PANIC' is already global"):(window.PANIC=await Promise.resolve().then((function(){return te})),this.isGlobal=!0,PANIC.Debug.warn("[PANIC] Namespace 'PANIC' has been made global")))}disable(){p&&(this.isGlobal?(window.PANIC=void 0,this.isGlobal=!1,PANIC.Debug.warn("[PANIC] Namespace 'PANIC' has been made private")):PANIC.Debug.warn("[PANIC] Namespace 'PANIC' is already private"))}toggle(){window.PANIC!=PANIC?this.enable():this.disable()}get THREE(){return Ft}};const Wt=new class{constructor(){this.id="PANIC-Debug-Grid",this.active=!1,this.geometry=new e.PlaneBufferGeometry(2,2,1,1),this.uniforms={uColor:{value:new e.Color(8947848)},uScale:{value:16},uSubdivisions:{value:16},uDistance:{value:100}},this.material=new e.ShaderMaterial({side:e.DoubleSide,uniforms:this.uniforms,vertexShader:St.vertex,fragmentShader:St.fragment,transparent:!0,depthWrite:!1,extensions:{derivatives:!0}}),this.mesh=new e.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.name=this.id}toggle(t=null){"boolean"==typeof t&&(this.active=!t),this.active?i.getObjectByName(this.id)&&i.remove(this.mesh):null==i.getObjectByName(this.id)&&i.add(this.mesh),this.active=!this.active}get scale(){return this.uniforms.uScale.value}set scale(t){this.uniforms.uScale.value=t}get subdivisions(){return this.uniforms.uSubdivisions.value}set subdivisions(t){this.uniforms.uSubdivisions.value=t}get distance(){return this.uniforms.uDistance.value}set distance(t){this.uniforms.uDistance.value=t}get color(){return this.uniforms.uColor.value}set color(t){this.uniforms.uColor.value=new e.Color(t)}};const Yt=new class{constructor(){this.id="PANIC-Debug-Axes",this.active=!1,this.colors={x:new e.Color(16724818),y:new e.Color(9165824),z:new e.Color(2658559)},this.geometry=new e.BufferGeometry,this.geometry.setAttribute("position",new e.Float32BufferAttribute([-1,0,0,1,0,0,0,0,-1,0,0,1,0,-1,0,0,1,0],3)),this.geometry.setAttribute("color",new e.Float32BufferAttribute([].concat(this.colors.x.toArray(),this.colors.x.toArray(),this.colors.y.toArray(),this.colors.y.toArray(),this.colors.z.toArray(),this.colors.z.toArray()),3)),this.geometry.setAttribute("opacity",new e.Float32BufferAttribute([1,1,1,1,1,1],1)),this.material=new e.ShaderMaterial({uniforms:xt.uniforms,vertexShader:xt.vertex,fragmentShader:xt.fragment,vertexColors:!0,transparent:!0,depthWrite:!1,extensions:{derivatives:!0}}),this.mesh=new e.LineSegments(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.name=this.id}toggle(t=null){"boolean"==typeof t&&(this.active=!t),this.active?i.getObjectByName(this.id)&&i.remove(this.mesh):null==i.getObjectByName(this.id)&&i.add(this.mesh),this.active=!this.active}toggleAxis(t,e=null){var n=[];t.toLowerCase().includes("x")&&n.push(0,1),t.toLowerCase().includes("y")&&n.push(2,3),t.toLowerCase().includes("z")&&n.push(4,5),n?(this.geometry.attributes.opacity.array.forEach(((t,i,s)=>{n.includes(i)&&(s[i]="boolean"==typeof e?e:1-t)})),this.geometry.attributes.opacity.needsUpdate=!0):f(`Invalid axes name "${axis}", use either 'x', 'y', or 'z'`)}updateColors(){this.geometry.attributes.colors.set([].concat(this.colors.x.toArray(),this.colors.x.toArray(),this.colors.y.toArray(),this.colors.y.toArray(),this.colors.z.toArray(),this.colors.z.toArray()),0),this.geometry.attributes.colors.needsUpdate=!0}setColors(t,e){}};let $t=new e.Spherical;let qt=new class{constructor(){this.id="PANIC-Debug-Compass",this.element=document.createElement("div"),this.element.id=this.id,this.active=!1,this.state=0}toggle(t=null){this.active="boolean"==typeof t?!t:!this.active,this.active?(vt.appendChild(this.element),d.add(this,15)):(vt.removeChild(this.element),d.remove(this))}update(){var t="",n=new e.Vector3(0,0,0);if(r.getWorldDirection(n),0==this.state){var i=Math.atan2(n.x,n.z),s=Math.round(i/Math.PI*180);s>=112.5||s<=-112.5?t+="N":s>=-67.5&&s<=67.5&&(t+="S"),s>=22.5&&s<=157.5?t+="E":s>=-157.5&&s<=-22.5&&(t+="W")}else if(1==this.state){$t.setFromVector3(n),$t.makeSafe();let e=Math.round($t.phi/Math.PI*180),i=Math.round($t.theta/Math.PI*180);t+=i>0?"+X":i<0?"-X":"X",t+=e>90?" +Y":e<90?" -Y":" Y",Math.abs(i)>90?t+=" +Z":Math.abs(i)<90?t+=" -Z":t+=" Z"}else if(2==this.state){$t.setFromVector3(n),$t.makeSafe(),t=`${Math.round($t.phi/Math.PI*180)} ${Math.round($t.theta/Math.PI*180)}`}this.element.innerHTML=`Facing: ${t}`}};class Xt{constructor(t){this.entity=t,this.collider=t.collider,this.status=!1,this.object=new e.Object3D,i.add(this.object),this.meshes={collision:new e.Object3D,box:null,sphere:null};let n=[];for(let t=0;t<this.collider.collision.length;t++){this.collider.collision[t],n.push(w.identity());let i=new e.LineSegments(n[t],new e.LineBasicMaterial({color:65280}));i.matrixAutoUpdate=!1,this.meshes.collision.add(i)}this.object.add(this.meshes.collision),this.meshes.box=new e.LineSegments(w.identity(),new e.LineBasicMaterial({color:16776960})),this.meshes.box.matrixAutoUpdate=!1,this.object.add(this.meshes.box);const s=new e.CircleGeometry(this.collider.boundingSphere.radius,64),r=new e.EdgesGeometry(s);this.meshes.sphere=new e.LineSegments(r,new e.LineBasicMaterial({color:16777215})),this.meshes.sphere.matrixAutoUpdate=!1,this.object.add(this.meshes.sphere)}enable(){}disable(){}toggle(){}update(){for(let t=0;t<this.collider.collision.length;t++)this.meshes.collision.children[t].matrix.copy(this.collider.collision[t].matrixWorld);this.meshes.box.matrix.copy(this.collider.boundingBox.matrixWorld);let t=new e.Vector3,n=new e.Vector3;this.collider.boundingSphere.matrixWorld.decompose(t,new e.Quaternion,n),this.meshes.sphere.lookAt(r.getWorldPosition(new e.Vector3)),this.meshes.sphere.matrix.compose(t,this.meshes.sphere.quaternion,n)}}class Zt{constructor(t){t.debug=this,this.entity=t,this._collision=null,d.add(this)}set collision(t){1==t&&null==this._collision?this._collision=new Xt(this.entity):0==t&&this._collision}update(){null!=this._collision&&this._collision.update()}}var Qt=Object.freeze({__proto__:null,Element:vt,Text:bt,Access:Kt,Grid:Wt,Axes:Yt,Compass:qt,Entity:function(t){return t.debug=new Zt(t)},get enabled(){return p},enable:function(){p=!0,console.info("[PANIC] Debug Mode Enabled")},disable:function(){p=!1,console.info("[PANIC] Debug Mode Disabled")},toggle:function(){p=!p},log:g,warn:f,error:function(t){p&&console.error(t)},clear:function(){p&&console.clear()},style:function(t,e){"string"==typeof e&&e instanceof String||(e=""),p&&console.log(t,e)}});let Jt="0.0.4";var te=Object.freeze({__proto__:null,Version:Jt,Scene:i,Camera:r,Renderer:E,Clock:y,Updater:d,Cube:w,Texture:_,OrbitControls:P,Element:o,Tile:O,TileGroup:D,Tileset:C,EventManager:v,Input:F,Entity:Et,EntityTemplate:wt,EntityRegistry:_t,Collision:At,Shaders:Tt,Loaders:Ht,Parsers:jt,Tools:K,Debug:Qt});t.Camera=r,t.Clock=y,t.Collision=At,t.Cube=w,t.Debug=Qt,t.Element=o,t.Entity=Et,t.EntityRegistry=_t,t.EntityTemplate=wt,t.EventManager=v,t.Input=F,t.Loaders=Ht,t.OrbitControls=P,t.Parsers=jt,t.Renderer=E,t.Scene=i,t.Shaders=Tt,t.Texture=_,t.Tile=O,t.TileGroup=D,t.Tileset=C,t.Tools=K,t.Updater=d,t.Version=Jt,Object.defineProperty(t,"__esModule",{value:!0})}));
